/*! For license information please see login.js.LICENSE.txt */
(()=>{"use strict";var e={"./src/MenuManager/login.ts":(e,t,o)=>{o.r(t),o.d(t,{handleReadyState:()=>w,handleRoomAction:()=>E,showErrorAnimation:()=>M,showRoomView:()=>O,updateButton:()=>v,updateColorPicker:()=>P,updatePlayerColor:()=>k,updateRoomList:()=>R});var n=o("./src/ViewModels/Player.ts"),r=o("./src/ViewModels/Room.ts"),s=o("./src/WebSocketClient/websocket.ts"),a=null,i=null,c=document.getElementById("roomCodeInput"),l=document.getElementById("usernameInput"),d=document.getElementById("joinButton"),u=document.getElementById("readyButton"),y=document.getElementById("login-div"),m=document.getElementById("room-div"),p=document.getElementById("color-picker"),g=document.getElementById("room-users-list"),f=document.getElementById("room-code"),b=document.getElementById("player-count"),h=document.getElementById("color-picker-container"),S=document.getElementById("start-progress-bar");function v(){""==l.value.trim()?d.disabled=!0:d.disabled=!1,5==c.value.trim().length?d.textContent="JOIN ROOM":d.textContent="CREATE ROOM"}function E(){var e=l.value;e&&(i=new n.Player(e),"CREATE ROOM"===d.innerText?(0,s.createRoom)(l.value):(0,s.joinRoom)(c.value.toUpperCase(),l.value))}function w(){i.isReady=!i.isReady,(0,s.setPlayerData)(i,a.getCode()),i.isReady?(u.classList.remove("red-button"),u.classList.add("green-button")):(u.classList.add("red-button"),u.classList.remove("green-button"))}function O(e){var t=JSON.parse(e.toString());a=new r.Room(t.room.code,t.room.host,t.room.players,t.room.maxSize),i.username==a.getHost().username&&document.getElementById("startButton").classList.remove("display-none"),h.style.backgroundColor=i.color,p.value=i.color,document.getElementById("color-label").style.color=C(p.value,"#FFFFFF","#000000"),y.classList.add("display-none"),m.classList.add("display-flex"),c.value=a.getCode(),f.innerHTML=a.getCode(),(0,s.setPlayerData)(i,a.getCode()),R(e)}function R(e){var t,o,n=JSON.parse(e.toString());a.setPlayers(n.room.players),a.setHost(n.room.host),a.setMaxSize(n.room.maxSize),b.innerHTML="".concat(a.getPlayers().length,"/").concat(a.getMaxSize()),g.innerHTML="",a.getPlayers().forEach((function(e){var t=document.createElement("li");t.textContent=e.username+"",e.username==a.getHost().username?t.insertAdjacentHTML("afterbegin",'<i class="fa-solid fa-crown" style="color: '.concat(e.color,';"></i>')):t.insertAdjacentHTML("afterbegin",'<i class="fa-solid fa-circle" style="color: '.concat(e.color,'; margin-left: 4px"></i>')),e.isReady?t.insertAdjacentHTML("beforeend",' <i class="fa-solid fa-circle" style="color: #37cb48;"></i>'):t.insertAdjacentHTML("beforeend",' <i class="fa-solid fa-circle" style="color: #cb3737;"></i>'),g.appendChild(t)})),t=a.getPlayers().filter((function(e){return e.isReady})).length,0!=(o=a.getMaxSize())&&(S.style.width=Math.floor(t/o*100)+"%")}function M(){d.classList.add("red-button"),d.classList.add("wiggle"),setTimeout((function(){d.classList.remove("red-button"),d.classList.remove("wiggle")}),600)}function P(){h.style.backgroundColor=p.value}function k(){i.color=p.value,document.getElementById("color-label").style.color=C(p.value,"#FFFFFF","#000000"),(0,s.setPlayerData)(i,a.getCode())}function C(e,t,o){var n="#"===e.charAt(0)?e.substring(1,7):e,r=[parseInt(n.substring(0,2),16)/255,parseInt(n.substring(2,4),16)/255,parseInt(n.substring(4,6),16)/255].map((function(e){return e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)}));return.2126*r[0]+.7152*r[1]+.0722*r[2]>.4?o:t}window.onload=function(){v()},window.updateButton=v,window.handleRoomAction=E,window.handleReadyState=w,window.updateColorPicker=P,window.updatePlayerColor=k,window.startGame=function(){}},"./src/ViewModels/Player.ts":(e,t,o)=>{o.r(t),o.d(t,{Player:()=>n});var n=function(){function e(e,t){void 0===t&&(t=!1),this.username=e,this.isReady=t,this.color="#000000".replace(/0/g,(function(){return(~~(16*Math.random())).toString(16)}))}return e.prototype.toJSON=function(){return{username:this.username,isReady:this.isReady,color:this.color}},e}()},"./src/ViewModels/Room.ts":(e,t,o)=>{o.r(t),o.d(t,{Room:()=>n});var n=function(){function e(e,t,o,n){void 0===n&&(n=5),this.players=[],this.code=e,this.host=t,this.maxSize=n,null!=o?this.players=o:this.addPlayer(t)}return e.prototype.addPlayer=function(e){return!(this.players.length>=this.maxSize||(this.players.push(e),0))},e.prototype.getCode=function(){return this.code},e.prototype.getPlayers=function(){return this.players},e.prototype.getHost=function(){return this.host},e.prototype.setHost=function(e){this.host=e},e.prototype.setPlayers=function(e){this.players=e},e.prototype.setMaxSize=function(e){this.maxSize=e},e.prototype.getMaxSize=function(){return this.maxSize},e}()},"./src/WebSocketClient/websocket.ts":(e,t,o)=>{o.r(t),o.d(t,{createRoom:()=>s,joinRoom:()=>a,sendKeyEventToServer:()=>c,setPlayerData:()=>i});var n,r=o("./src/MenuManager/login.ts");function s(e){n&&n.readyState===WebSocket.OPEN?n.send(JSON.stringify({type:"CREATE_ROOM",username:e})):console.error("WebSocket connection is not open")}function a(e,t){n&&n.readyState===WebSocket.OPEN?n.send(JSON.stringify({type:"JOIN_ROOM",roomCode:e,username:t})):console.error("WebSocket connection is not open")}function i(e,t){n&&n.readyState===WebSocket.OPEN?n.send(JSON.stringify({type:"PLAYER_DATA",player:e,roomCode:t})):console.error("WebSocket connection is not open")}function c(e,t){n&&n.readyState===WebSocket.OPEN?n.send(JSON.stringify({type:"KEY_EVENT",key:e,pressed:t})):console.error("WebSocket connection is not open")}(n=new WebSocket("ws://".concat(window.location.hostname,":8080"))).onopen=function(){console.log("WebSocket connection established")},n.onmessage=function(e){var t=JSON.parse(e.data);switch(console.log("Message from server:",t),t.type){case"JOINED_ROOM":(0,r.showRoomView)(e.data);break;case"ROOM_DOES_NOT_EXIST":(0,r.showErrorAnimation)();break;case"ROOM_DATA":(0,r.updateRoomList)(e.data);break;case"GAMEPLAY":break;case"ERROR":alert("Error: ".concat(t.message))}},n.onclose=function(){console.log("WebSocket connection closed")},n.onerror=function(e){console.error("WebSocket error:",e)}}},t={};function o(n){var r=t[n];if(void 0!==r)return r.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,o),s.exports}o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o("./src/MenuManager/login.ts")})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEVBQUtDLEdDQ2xGZCxFQUFvQmtCLEVBQUtmLElBQ0gsb0JBQVhnQixRQUEwQkEsT0FBT0MsYUFDMUNYLE9BQU9DLGVBQWVQLEVBQVNnQixPQUFPQyxZQUFhLENBQUU1SCxNQUFPLFdBRTdEaUgsT0FBT0MsZUFBZVAsRUFBUyxhQUFjLENBQUUzRyxPQUFPLEdBQU8sRUNGcEN3RyxFQUFvQiIsInNvdXJjZXMiOlsid2VicGFjazovL3NuYWtlX2dhbWUvLi9zcmMvTWVudU1hbmFnZXIvbG9naW4udHMiLCJ3ZWJwYWNrOi8vc25ha2VfZ2FtZS8uL3NyYy9WaWV3TW9kZWxzL1BsYXllci50cyIsIndlYnBhY2s6Ly9zbmFrZV9nYW1lLy4vc3JjL1ZpZXdNb2RlbHMvUm9vbS50cyIsIndlYnBhY2s6Ly9zbmFrZV9nYW1lLy4vc3JjL1dlYlNvY2tldENsaWVudC93ZWJzb2NrZXQudHMiLCJ3ZWJwYWNrOi8vc25ha2VfZ2FtZS93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9zbmFrZV9nYW1lL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly9zbmFrZV9nYW1lL3dlYnBhY2svcnVudGltZS9oYXNPd25Qcm9wZXJ0eSBzaG9ydGhhbmQiLCJ3ZWJwYWNrOi8vc25ha2VfZ2FtZS93ZWJwYWNrL3J1bnRpbWUvbWFrZSBuYW1lc3BhY2Ugb2JqZWN0Iiwid2VicGFjazovL3NuYWtlX2dhbWUvd2VicGFjay9zdGFydHVwIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBsYXllciB9IGZyb20gXCIuLi9WaWV3TW9kZWxzL1BsYXllclwiO1xyXG5pbXBvcnQgeyBSb29tIH0gZnJvbSBcIi4uL1ZpZXdNb2RlbHMvUm9vbVwiO1xyXG5pbXBvcnQgeyBjcmVhdGVSb29tLCBqb2luUm9vbSwgc2V0UGxheWVyRGF0YSB9IGZyb20gXCIuLi9XZWJTb2NrZXRDbGllbnQvd2Vic29ja2V0XCI7XHJcblxyXG5cclxubGV0IGN1cnJlbnRSb29tOiBSb29tIHwgbnVsbCA9IG51bGw7XHJcbmxldCBjdXJyZW50UGxheWVyOiBQbGF5ZXIgfCBudWxsID0gbnVsbDtcclxuXHJcbmNvbnN0IHJvb21Db2RlSW5wdXQgPSAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jvb21Db2RlSW5wdXQnKSBhcyBIVE1MSW5wdXRFbGVtZW50KTtcclxuY29uc3QgdXNlcm5hbWVJbnB1dCA9IChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXNlcm5hbWVJbnB1dCcpIGFzIEhUTUxJbnB1dEVsZW1lbnQpO1xyXG5jb25zdCByb29tQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2pvaW5CdXR0b24nKSBhcyBIVE1MQnV0dG9uRWxlbWVudDtcclxuY29uc3QgcmVhZHlCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVhZHlCdXR0b24nKSBhcyBIVE1MQnV0dG9uRWxlbWVudDtcclxuY29uc3QgbG9naW5EaXY9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dpbi1kaXYnKSBhcyBIVE1MQnV0dG9uRWxlbWVudDtcclxuY29uc3Qgcm9vbURpdj0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jvb20tZGl2JykgYXMgSFRNTEJ1dHRvbkVsZW1lbnQ7XHJcbmNvbnN0IGNvbG9yUGlja2VyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbG9yLXBpY2tlcicpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XHJcbmNvbnN0IHJvb21Vc2Vyc0xpc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncm9vbS11c2Vycy1saXN0JykgYXMgSFRNTFVMaXN0RWxlbWVudDtcclxuY29uc3Qgcm9vbUNvZGVTcGFuPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncm9vbS1jb2RlJykgYXMgSFRNTFBhcmFncmFwaEVsZW1lbnQ7XHJcbmNvbnN0IHBsYXllckNvdW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BsYXllci1jb3VudCcpIGFzIEhUTUxQYXJhZ3JhcGhFbGVtZW50O1xyXG5jb25zdCBjb2xvclBpY2tlckRpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb2xvci1waWNrZXItY29udGFpbmVyJyk7XHJcbmNvbnN0IHN0YXJ0UHJvZ3Jlc3NCYXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RhcnQtcHJvZ3Jlc3MtYmFyJyk7XHJcbi8vIHNyYy9sb2dpbi50c1xyXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlQnV0dG9uKCkge1xyXG4gICAgXHJcblxyXG4gICAgaWYgKHVzZXJuYW1lSW5wdXQudmFsdWUudHJpbSgpID09ICcnKSB7XHJcbiAgICAgICAgcm9vbUJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJvb21CdXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAocm9vbUNvZGVJbnB1dC52YWx1ZS50cmltKCkubGVuZ3RoID09IDUpIHtcclxuICAgICAgICByb29tQnV0dG9uLnRleHRDb250ZW50ID0gJ0pPSU4gUk9PTSc7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJvb21CdXR0b24udGV4dENvbnRlbnQgPSAnQ1JFQVRFIFJPT00nO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaGFuZGxlUm9vbUFjdGlvbigpIHtcclxuICAgIGNvbnN0IHVzZXJuYW1lID0gdXNlcm5hbWVJbnB1dC52YWx1ZTtcclxuICAgIGlmICghdXNlcm5hbWUpIHJldHVybjtcclxuICAgIFxyXG4gICAgY3VycmVudFBsYXllciA9IG5ldyBQbGF5ZXIodXNlcm5hbWUpO1xyXG5cclxuICAgIGlmIChyb29tQnV0dG9uLmlubmVyVGV4dCA9PT0gJ0NSRUFURSBST09NJykge1xyXG4gICAgICAgIGNyZWF0ZVJvb20odXNlcm5hbWVJbnB1dC52YWx1ZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIFxyXG4gICAgICAgIGpvaW5Sb29tKHJvb21Db2RlSW5wdXQudmFsdWUudG9VcHBlckNhc2UoKSwgdXNlcm5hbWVJbnB1dC52YWx1ZSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBoYW5kbGVSZWFkeVN0YXRlKCkge1xyXG4gICAgXHJcbiAgICBjdXJyZW50UGxheWVyLmlzUmVhZHkgPSAhY3VycmVudFBsYXllci5pc1JlYWR5O1xyXG4gICAgc2V0UGxheWVyRGF0YShjdXJyZW50UGxheWVyLCBjdXJyZW50Um9vbS5nZXRDb2RlKCkpO1xyXG4gICAgdXBkYXRlUmVhZHlCdXR0b24oY3VycmVudFBsYXllci5pc1JlYWR5KTtcclxuICAgIFxyXG59XHJcblxyXG5mdW5jdGlvbiB1cGRhdGVSZWFkeUJ1dHRvbihpc1JlYWR5OiBib29sZWFuKSB7XHJcbiAgICBpZihpc1JlYWR5KXtcclxuICAgICAgICByZWFkeUJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCdyZWQtYnV0dG9uJyk7XHJcbiAgICAgICAgcmVhZHlCdXR0b24uY2xhc3NMaXN0LmFkZCgnZ3JlZW4tYnV0dG9uJyk7XHJcbiAgICB9XHJcbiAgICBlbHNle1xyXG4gICAgICAgIHJlYWR5QnV0dG9uLmNsYXNzTGlzdC5hZGQoJ3JlZC1idXR0b24nKTtcclxuICAgICAgICByZWFkeUJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCdncmVlbi1idXR0b24nKTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNob3dSb29tVmlldyhkYXRhOiBKU09OKXtcclxuICAgIC8vc2V0IHRoZSBjbGllbnQgVmlld01vZGVsIG9mIHRoZSByb29tIHRvIHRoZSBzZXJ2ZXJzIHJlc3BvbnNlXHJcbiAgICBsZXQgcm9vbUluZm8gPSBKU09OLnBhcnNlKGRhdGEudG9TdHJpbmcoKSk7XHJcbiAgICBjdXJyZW50Um9vbSA9IG5ldyBSb29tIChyb29tSW5mb1sncm9vbSddWydjb2RlJ10sIHJvb21JbmZvWydyb29tJ11bJ2hvc3QnXSwgcm9vbUluZm9bJ3Jvb20nXVsncGxheWVycyddLCByb29tSW5mb1sncm9vbSddWydtYXhTaXplJ10pXHJcblxyXG4gICAgICAgIC8vc2hvdyBzdGFydEdhbWVCdXR0b24gXHJcbiAgICAgICAgaWYoY3VycmVudFBsYXllci51c2VybmFtZSA9PSBjdXJyZW50Um9vbS5nZXRIb3N0KCkudXNlcm5hbWUpIFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RhcnRCdXR0b24nKS5jbGFzc0xpc3QucmVtb3ZlKCdkaXNwbGF5LW5vbmUnKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgIC8vc2V0IGEgcmFuZG9tIGNvbG9yIGZvciBhIHBsYXllclxyXG4gICAgY29sb3JQaWNrZXJEaXYuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gY3VycmVudFBsYXllci5jb2xvcjtcclxuICAgIGNvbG9yUGlja2VyLnZhbHVlID0gY3VycmVudFBsYXllci5jb2xvcjtcclxuICAgIGxldCBjb2xvclBpY2tlckxhYmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbG9yLWxhYmVsJyk7XHJcbiAgICBjb2xvclBpY2tlckxhYmVsLnN0eWxlLmNvbG9yID0gcGlja1RleHRDb2xvckJhc2VkT25CZ0NvbG9yQWR2YW5jZWQoY29sb3JQaWNrZXIudmFsdWUsICcjRkZGRkZGJywgJyMwMDAwMDAnKTtcclxuXHJcbiAgICAvL3Nob3cgdGhlIG5ldyBlbGVtZW50XHJcbiAgICBsb2dpbkRpdi5jbGFzc0xpc3QuYWRkKCdkaXNwbGF5LW5vbmUnKTtcclxuICAgIHJvb21EaXYuY2xhc3NMaXN0LmFkZCgnZGlzcGxheS1mbGV4Jyk7XHJcblxyXG5cclxuXHJcbiAgICByb29tQ29kZUlucHV0LnZhbHVlID0gY3VycmVudFJvb20uZ2V0Q29kZSgpO1xyXG4gICAgcm9vbUNvZGVTcGFuLmlubmVySFRNTCAgPSBjdXJyZW50Um9vbS5nZXRDb2RlKCk7XHJcbiAgICBzZXRQbGF5ZXJEYXRhKGN1cnJlbnRQbGF5ZXIsIGN1cnJlbnRSb29tLmdldENvZGUoKSk7XHJcbiAgICB1cGRhdGVSb29tTGlzdChkYXRhKTtcclxuICAgIFxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlUm9vbUxpc3QoZGF0YTogSlNPTil7XHJcbiAgICBsZXQgcm9vbUluZm8gPSBKU09OLnBhcnNlKGRhdGEudG9TdHJpbmcoKSk7XHJcblxyXG4gICAgLy8gdXBkYXRpbmcgdGhlIGN1cnJlbnQgcm9vbSBwbGF5ZXJzIGFuZCBob3N0XHJcbiAgICBjdXJyZW50Um9vbS5zZXRQbGF5ZXJzKHJvb21JbmZvWydyb29tJ11bJ3BsYXllcnMnXSk7XHJcbiAgICBjdXJyZW50Um9vbS5zZXRIb3N0KHJvb21JbmZvWydyb29tJ11bJ2hvc3QnXSk7XHJcbiAgICBjdXJyZW50Um9vbS5zZXRNYXhTaXplKHJvb21JbmZvWydyb29tJ11bJ21heFNpemUnXSlcclxuICAgIFxyXG5cclxuICAgIHBsYXllckNvdW50LmlubmVySFRNTCA9IGAke2N1cnJlbnRSb29tLmdldFBsYXllcnMoKS5sZW5ndGh9LyR7Y3VycmVudFJvb20uZ2V0TWF4U2l6ZSgpfWA7XHJcbiAgICByb29tVXNlcnNMaXN0LmlubmVySFRNTCA9ICcnO1xyXG5cclxuICAgIGN1cnJlbnRSb29tLmdldFBsYXllcnMoKS5mb3JFYWNoKChwbGF5ZXI6IHsgdXNlcm5hbWU6IHN0cmluZyB8IG51bWJlcjsgaXNSZWFkeTogYm9vbGVhbjsgY29sb3I6IHN0cmluZzt9KSA9PiB7XHJcbiAgICAgICAgY29uc3QgcGxheWVySXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XHJcblxyXG4gICAgICAgIHBsYXllckl0ZW0udGV4dENvbnRlbnQgPSBwbGF5ZXIudXNlcm5hbWUgKyAnJztcclxuICAgICAgICBcclxuICAgICAgICBpZihwbGF5ZXIudXNlcm5hbWUgPT0gY3VycmVudFJvb20uZ2V0SG9zdCgpLnVzZXJuYW1lKSB7XHJcbiAgICAgICAgICAgIHBsYXllckl0ZW0uaW5zZXJ0QWRqYWNlbnRIVE1MKCdhZnRlcmJlZ2luJywgYDxpIGNsYXNzPVwiZmEtc29saWQgZmEtY3Jvd25cIiBzdHlsZT1cImNvbG9yOiAke3BsYXllci5jb2xvcn07XCI+PC9pPmApXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICBwbGF5ZXJJdGVtLmluc2VydEFkamFjZW50SFRNTCgnYWZ0ZXJiZWdpbicsIGA8aSBjbGFzcz1cImZhLXNvbGlkIGZhLWNpcmNsZVwiIHN0eWxlPVwiY29sb3I6ICR7cGxheWVyLmNvbG9yfTsgbWFyZ2luLWxlZnQ6IDRweFwiPjwvaT5gKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHBsYXllci5pc1JlYWR5KSB7XHJcbiAgICAgICAgICAgIHBsYXllckl0ZW0uaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVlbmQnLCAnIDxpIGNsYXNzPVwiZmEtc29saWQgZmEtY2lyY2xlXCIgc3R5bGU9XCJjb2xvcjogIzM3Y2I0ODtcIj48L2k+Jyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcGxheWVySXRlbS5pbnNlcnRBZGphY2VudEhUTUwoJ2JlZm9yZWVuZCcsICcgPGkgY2xhc3M9XCJmYS1zb2xpZCBmYS1jaXJjbGVcIiBzdHlsZT1cImNvbG9yOiAjY2IzNzM3O1wiPjwvaT4nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJvb21Vc2Vyc0xpc3QuYXBwZW5kQ2hpbGQocGxheWVySXRlbSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB1cGRhdGVTdGFydEJ1dHRvblByb2dyZXNzKGN1cnJlbnRSb29tLmdldFBsYXllcnMoKS5maWx0ZXIocCA9PiBwLmlzUmVhZHkpLmxlbmd0aCwgY3VycmVudFJvb20uZ2V0TWF4U2l6ZSgpKTtcclxufVxyXG5cclxuXHJcbmZ1bmN0aW9uIHVwZGF0ZVN0YXJ0QnV0dG9uUHJvZ3Jlc3MocmVhZHlQbGF5ZXJDb3VudDogbnVtYmVyLCBtYXhQbGF5ZXJDb3VudDogbnVtYmVyKXtcclxuICAgIGlmIChtYXhQbGF5ZXJDb3VudCA9PSAwKXtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBzdGFydFByb2dyZXNzQmFyLnN0eWxlLndpZHRoID0gIE1hdGguZmxvb3IocmVhZHlQbGF5ZXJDb3VudC9tYXhQbGF5ZXJDb3VudCoxMDApICsgJyUnO1xyXG59XHJcbmV4cG9ydCBmdW5jdGlvbiBzaG93RXJyb3JBbmltYXRpb24oKSB7XHJcbiAgICByb29tQnV0dG9uLmNsYXNzTGlzdC5hZGQoJ3JlZC1idXR0b24nKTtcclxuICAgIHJvb21CdXR0b24uY2xhc3NMaXN0LmFkZCgnd2lnZ2xlJyk7XHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgIHJvb21CdXR0b24uY2xhc3NMaXN0LnJlbW92ZSgncmVkLWJ1dHRvbicpO1xyXG4gICAgcm9vbUJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCd3aWdnbGUnKTtcclxuICAgIH0sIDYwMClcclxufVxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVDb2xvclBpY2tlcigpIHtcclxuICAgIGNvbG9yUGlja2VyRGl2LnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGNvbG9yUGlja2VyLnZhbHVlO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlUGxheWVyQ29sb3IoKSB7XHJcbiAgICBjdXJyZW50UGxheWVyLmNvbG9yID0gY29sb3JQaWNrZXIudmFsdWU7XHJcbiAgICBsZXQgY29sb3JQaWNrZXJMYWJlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb2xvci1sYWJlbCcpO1xyXG4gICAgY29sb3JQaWNrZXJMYWJlbC5zdHlsZS5jb2xvciA9IHBpY2tUZXh0Q29sb3JCYXNlZE9uQmdDb2xvckFkdmFuY2VkKGNvbG9yUGlja2VyLnZhbHVlLCAnI0ZGRkZGRicsICcjMDAwMDAwJyk7XHJcbiAgICBzZXRQbGF5ZXJEYXRhKGN1cnJlbnRQbGF5ZXIsIGN1cnJlbnRSb29tLmdldENvZGUoKSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHBpY2tUZXh0Q29sb3JCYXNlZE9uQmdDb2xvckFkdmFuY2VkKGJnQ29sb3I6c3RyaW5nLCBsaWdodENvbG9yOiBzdHJpbmcsIGRhcmtDb2xvcjogc3RyaW5nKSB7XHJcbiAgICB2YXIgY29sb3IgPSAoYmdDb2xvci5jaGFyQXQoMCkgPT09ICcjJykgPyBiZ0NvbG9yLnN1YnN0cmluZygxLCA3KSA6IGJnQ29sb3I7XHJcbiAgICB2YXIgciA9IHBhcnNlSW50KGNvbG9yLnN1YnN0cmluZygwLCAyKSwgMTYpOyAvLyBoZXhUb1JcclxuICAgIHZhciBnID0gcGFyc2VJbnQoY29sb3Iuc3Vic3RyaW5nKDIsIDQpLCAxNik7IC8vIGhleFRvR1xyXG4gICAgdmFyIGIgPSBwYXJzZUludChjb2xvci5zdWJzdHJpbmcoNCwgNiksIDE2KTsgLy8gaGV4VG9CXHJcbiAgICB2YXIgdWljb2xvcnMgPSBbciAvIDI1NSwgZyAvIDI1NSwgYiAvIDI1NV07XHJcbiAgICB2YXIgYyA9IHVpY29sb3JzLm1hcCgoY29sKSA9PiB7XHJcbiAgICAgIGlmIChjb2wgPD0gMC4wMzkyOCkge1xyXG4gICAgICAgIHJldHVybiBjb2wgLyAxMi45MjtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gTWF0aC5wb3coKGNvbCArIDAuMDU1KSAvIDEuMDU1LCAyLjQpO1xyXG4gICAgfSk7XHJcbiAgICB2YXIgTCA9ICgwLjIxMjYgKiBjWzBdKSArICgwLjcxNTIgKiBjWzFdKSArICgwLjA3MjIgKiBjWzJdKTtcclxuICAgIHJldHVybiAoTCA+IDAuNCkgPyBkYXJrQ29sb3IgOiBsaWdodENvbG9yO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gc3RhcnRHYW1lKCkge1xyXG5cclxuICB9XHJcblxyXG53aW5kb3cub25sb2FkID0gKCkgPT4ge1xyXG4gICAgdXBkYXRlQnV0dG9uKCk7XHJcbn07XHJcblxyXG4od2luZG93IGFzIGFueSkudXBkYXRlQnV0dG9uID0gdXBkYXRlQnV0dG9uO1xyXG4od2luZG93IGFzIGFueSkuaGFuZGxlUm9vbUFjdGlvbiA9IGhhbmRsZVJvb21BY3Rpb247XHJcbih3aW5kb3cgYXMgYW55KS5oYW5kbGVSZWFkeVN0YXRlID0gaGFuZGxlUmVhZHlTdGF0ZTtcclxuKHdpbmRvdyBhcyBhbnkpLnVwZGF0ZUNvbG9yUGlja2VyID0gdXBkYXRlQ29sb3JQaWNrZXI7XHJcbih3aW5kb3cgYXMgYW55KS51cGRhdGVQbGF5ZXJDb2xvciA9IHVwZGF0ZVBsYXllckNvbG9yO1xyXG4od2luZG93IGFzIGFueSkuc3RhcnRHYW1lID0gc3RhcnRHYW1lOyIsImV4cG9ydCBjbGFzcyBQbGF5ZXIge1xyXG4gICAgcHVibGljIHVzZXJuYW1lOiBzdHJpbmc7XHJcbiAgICBwdWJsaWMgaXNSZWFkeTogYm9vbGVhbjtcclxuICAgIHB1YmxpYyBjb2xvcjogc3RyaW5nO1xyXG4gICAgXHJcbiAgICBjb25zdHJ1Y3Rvcih1c2VybmFtZTogc3RyaW5nLCBpc1JlYWR5OiBib29sZWFuID0gZmFsc2UpIHtcclxuICAgICAgICB0aGlzLnVzZXJuYW1lID0gdXNlcm5hbWU7XHJcbiAgICAgICAgdGhpcy5pc1JlYWR5ID0gaXNSZWFkeTtcclxuICAgICAgICB0aGlzLmNvbG9yID0gXCIjMDAwMDAwXCIucmVwbGFjZSgvMC9nLGZ1bmN0aW9uKCl7cmV0dXJuICh+fihNYXRoLnJhbmRvbSgpKjE2KSkudG9TdHJpbmcoMTYpO30pO1xyXG4gICAgfVxyXG5cclxuICAgIHRvSlNPTigpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgdXNlcm5hbWU6IHRoaXMudXNlcm5hbWUsXHJcbiAgICAgICAgICBpc1JlYWR5OiB0aGlzLmlzUmVhZHksXHJcbiAgICAgICAgICBjb2xvcjogdGhpcy5jb2xvclxyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuXHJcbn0iLCJpbXBvcnQgeyBQbGF5ZXIgfSBmcm9tIFwiLi9QbGF5ZXJcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBSb29tIHtcclxuICAgIHByaXZhdGUgcGxheWVyczogUGxheWVyW10gPSBbXTtcclxuICAgIHByaXZhdGUgbWF4U2l6ZTogbnVtYmVyO1xyXG4gICAgcHJpdmF0ZSBob3N0OiBQbGF5ZXI7XHJcbiAgICBwcml2YXRlIGNvZGU6IHN0cmluZztcclxuXHJcblxyXG4gICAgY29uc3RydWN0b3IoY29kZTogc3RyaW5nLCBob3N0OiBQbGF5ZXIsIHBsYXllcnM/OiBQbGF5ZXJbXSwgbWF4U2l6ZTogbnVtYmVyID0gNSkge1xyXG4gICAgICAgIHRoaXMuY29kZSA9IGNvZGU7XHJcbiAgICAgICAgdGhpcy5ob3N0ID0gaG9zdDtcclxuICAgICAgICB0aGlzLm1heFNpemUgPSBtYXhTaXplO1xyXG5cclxuICAgICAgICBpZiAocGxheWVycyAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5wbGF5ZXJzID0gcGxheWVycztcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgdGhpcy5hZGRQbGF5ZXIoaG9zdCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgYWRkUGxheWVyKHBsYXllcjogUGxheWVyKTogYm9vbGVhbiB7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLnBsYXllcnMubGVuZ3RoID49IHRoaXMubWF4U2l6ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnBsYXllcnMucHVzaChwbGF5ZXIpXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldENvZGUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY29kZTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0UGxheWVycygpOiBQbGF5ZXJbXSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucGxheWVycztcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0SG9zdCgpOiBQbGF5ZXIge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmhvc3Q7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldEhvc3QocGxheWVyOiBQbGF5ZXIpIHtcclxuICAgICAgICB0aGlzLmhvc3QgPSBwbGF5ZXI7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldFBsYXllcnMocGxheWVyczogUGxheWVyW10pe1xyXG4gICAgICAgIHRoaXMucGxheWVycyA9IHBsYXllcnM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldE1heFNpemUobmV3U2l6ZTogbnVtYmVyKXtcclxuICAgICAgICB0aGlzLm1heFNpemUgPSBuZXdTaXplO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRNYXhTaXplKCl7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubWF4U2l6ZTtcclxuICAgIH1cclxufSIsImltcG9ydCB7IHNob3dFcnJvckFuaW1hdGlvbiwgc2hvd1Jvb21WaWV3LCB1cGRhdGVSb29tTGlzdCB9IGZyb20gXCIuLi9NZW51TWFuYWdlci9sb2dpblwiO1xyXG5pbXBvcnQgeyBQbGF5ZXIgfSBmcm9tIFwiLi4vVmlld01vZGVscy9QbGF5ZXJcIjtcclxuXHJcbmxldCBzb2NrZXQ6IFdlYlNvY2tldDtcclxuXHJcbmZ1bmN0aW9uIGluaXRXZWJTb2NrZXQoKSB7XHJcbiAgICBzb2NrZXQgPSBuZXcgV2ViU29ja2V0KGB3czovLyR7d2luZG93LmxvY2F0aW9uLmhvc3RuYW1lfTo4MDgwYCk7XHJcbiAgICBcclxuICAgIHNvY2tldC5vbm9wZW4gPSAoKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1dlYlNvY2tldCBjb25uZWN0aW9uIGVzdGFibGlzaGVkJyk7XHJcbiAgICB9O1xyXG5cclxuICAgIHNvY2tldC5vbm1lc3NhZ2UgPSAoZXZlbnQpID0+IHtcclxuICAgICAgICBjb25zdCBkYXRhID0gSlNPTi5wYXJzZShldmVudC5kYXRhKTtcclxuICAgICAgICBjb25zb2xlLmxvZygnTWVzc2FnZSBmcm9tIHNlcnZlcjonLCBkYXRhKTtcclxuICAgICAgICBcclxuICAgICAgICBzd2l0Y2ggKGRhdGEudHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlICdKT0lORURfUk9PTSc6XHJcbiAgICAgICAgICAgICAgICBzaG93Um9vbVZpZXcoZXZlbnQuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnUk9PTV9ET0VTX05PVF9FWElTVCc6XHJcbiAgICAgICAgICAgICAgICBzaG93RXJyb3JBbmltYXRpb24oKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdST09NX0RBVEEnOlxyXG4gICAgICAgICAgICAgICAgdXBkYXRlUm9vbUxpc3QoZXZlbnQuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnR0FNRVBMQVknOlxyXG4gICAgICAgICAgICAgICAgLy8gdXBkYXRlR2FtZUNhbnZhcygpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ0VSUk9SJzpcclxuICAgICAgICAgICAgICAgIGFsZXJ0KGBFcnJvcjogJHtkYXRhLm1lc3NhZ2V9YCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBzb2NrZXQub25jbG9zZSA9ICgpID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZygnV2ViU29ja2V0IGNvbm5lY3Rpb24gY2xvc2VkJyk7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBzb2NrZXQub25lcnJvciA9IChlcnJvcikgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1dlYlNvY2tldCBlcnJvcjonLCBlcnJvcik7XHJcbiAgICB9O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlUm9vbSh1c2VybmFtZTogc3RyaW5nKSB7XHJcbiAgICBpZiAoc29ja2V0ICYmIHNvY2tldC5yZWFkeVN0YXRlID09PSBXZWJTb2NrZXQuT1BFTikge1xyXG4gICAgICAgIHNvY2tldC5zZW5kKEpTT04uc3RyaW5naWZ5KHsgdHlwZTogJ0NSRUFURV9ST09NJywgdXNlcm5hbWU6IHVzZXJuYW1lIH0pKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignV2ViU29ja2V0IGNvbm5lY3Rpb24gaXMgbm90IG9wZW4nKTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGpvaW5Sb29tKHJvb21Db2RlOiBzdHJpbmcsIHVzZXJuYW1lOiBzdHJpbmcpIHtcclxuICAgIGlmIChzb2NrZXQgJiYgc29ja2V0LnJlYWR5U3RhdGUgPT09IFdlYlNvY2tldC5PUEVOKSB7XHJcbiAgICAgICAgc29ja2V0LnNlbmQoSlNPTi5zdHJpbmdpZnkoeyB0eXBlOiAnSk9JTl9ST09NJywgcm9vbUNvZGU6IHJvb21Db2RlLCB1c2VybmFtZTogdXNlcm5hbWUgfSkpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdXZWJTb2NrZXQgY29ubmVjdGlvbiBpcyBub3Qgb3BlbicpO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc2V0UGxheWVyRGF0YShwbGF5ZXI6IFBsYXllciwgcm9vbUNvZGU6IHN0cmluZykge1xyXG4gICAgaWYgKHNvY2tldCAmJiBzb2NrZXQucmVhZHlTdGF0ZSA9PT0gV2ViU29ja2V0Lk9QRU4pIHtcclxuICAgICAgICBzb2NrZXQuc2VuZChKU09OLnN0cmluZ2lmeSh7IHR5cGU6ICdQTEFZRVJfREFUQScsIHBsYXllcjogcGxheWVyLCByb29tQ29kZTogcm9vbUNvZGV9KSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1dlYlNvY2tldCBjb25uZWN0aW9uIGlzIG5vdCBvcGVuJyk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBzZW5kS2V5RXZlbnRUb1NlcnZlcihrZXk6IHN0cmluZywgcHJlc3NlZDogYm9vbGVhbil7XHJcbiAgICBpZiAoc29ja2V0ICYmIHNvY2tldC5yZWFkeVN0YXRlID09PSBXZWJTb2NrZXQuT1BFTikge1xyXG4gICAgICAgIHNvY2tldC5zZW5kKEpTT04uc3RyaW5naWZ5KHsgdHlwZTogJ0tFWV9FVkVOVCcsIGtleToga2V5LCBwcmVzc2VkOiBwcmVzc2VkIH0pKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignV2ViU29ja2V0IGNvbm5lY3Rpb24gaXMgbm90IG9wZW4nKTtcclxuICAgIH1cclxufVxyXG5cclxuXHJcbmluaXRXZWJTb2NrZXQoKTtcclxuIiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0dmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07XG5cdGlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdHJldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXShtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbiIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCIvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSAoZXhwb3J0cykgPT4ge1xuXHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcblx0fVxuXHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xufTsiLCIvLyBzdGFydHVwXG4vLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbi8vIFRoaXMgZW50cnkgbW9kdWxlIGlzIHJlZmVyZW5jZWQgYnkgb3RoZXIgbW9kdWxlcyBzbyBpdCBjYW4ndCBiZSBpbmxpbmVkXG52YXIgX193ZWJwYWNrX2V4cG9ydHNfXyA9IF9fd2VicGFja19yZXF1aXJlX18oXCIuL3NyYy9NZW51TWFuYWdlci9sb2dpbi50c1wiKTtcbiJdLCJuYW1lcyI6WyJjdXJyZW50Um9vbSIsImN1cnJlbnRQbGF5ZXIiLCJyb29tQ29kZUlucHV0IiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInVzZXJuYW1lSW5wdXQiLCJyb29tQnV0dG9uIiwicmVhZHlCdXR0b24iLCJsb2dpbkRpdiIsInJvb21EaXYiLCJjb2xvclBpY2tlciIsInJvb21Vc2Vyc0xpc3QiLCJyb29tQ29kZVNwYW4iLCJwbGF5ZXJDb3VudCIsImNvbG9yUGlja2VyRGl2Iiwic3RhcnRQcm9ncmVzc0JhciIsInVwZGF0ZUJ1dHRvbiIsInZhbHVlIiwidHJpbSIsImRpc2FibGVkIiwibGVuZ3RoIiwidGV4dENvbnRlbnQiLCJoYW5kbGVSb29tQWN0aW9uIiwidXNlcm5hbWUiLCJQbGF5ZXIiLCJpbm5lclRleHQiLCJjcmVhdGVSb29tIiwiam9pblJvb20iLCJ0b1VwcGVyQ2FzZSIsImhhbmRsZVJlYWR5U3RhdGUiLCJpc1JlYWR5Iiwic2V0UGxheWVyRGF0YSIsImdldENvZGUiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJhZGQiLCJzaG93Um9vbVZpZXciLCJkYXRhIiwicm9vbUluZm8iLCJKU09OIiwicGFyc2UiLCJ0b1N0cmluZyIsIlJvb20iLCJnZXRIb3N0Iiwic3R5bGUiLCJiYWNrZ3JvdW5kQ29sb3IiLCJjb2xvciIsInBpY2tUZXh0Q29sb3JCYXNlZE9uQmdDb2xvckFkdmFuY2VkIiwiaW5uZXJIVE1MIiwidXBkYXRlUm9vbUxpc3QiLCJyZWFkeVBsYXllckNvdW50IiwibWF4UGxheWVyQ291bnQiLCJzZXRQbGF5ZXJzIiwic2V0SG9zdCIsInNldE1heFNpemUiLCJnZXRQbGF5ZXJzIiwiZ2V0TWF4U2l6ZSIsImZvckVhY2giLCJwbGF5ZXIiLCJwbGF5ZXJJdGVtIiwiY3JlYXRlRWxlbWVudCIsImluc2VydEFkamFjZW50SFRNTCIsImFwcGVuZENoaWxkIiwiZmlsdGVyIiwicCIsIndpZHRoIiwiTWF0aCIsImZsb29yIiwic2hvd0Vycm9yQW5pbWF0aW9uIiwic2V0VGltZW91dCIsInVwZGF0ZUNvbG9yUGlja2VyIiwidXBkYXRlUGxheWVyQ29sb3IiLCJiZ0NvbG9yIiwibGlnaHRDb2xvciIsImRhcmtDb2xvciIsImNoYXJBdCIsInN1YnN0cmluZyIsImMiLCJwYXJzZUludCIsIm1hcCIsImNvbCIsInBvdyIsIndpbmRvdyIsIm9ubG9hZCIsInN0YXJ0R2FtZSIsInRoaXMiLCJyZXBsYWNlIiwicmFuZG9tIiwidG9KU09OIiwiY29kZSIsImhvc3QiLCJwbGF5ZXJzIiwibWF4U2l6ZSIsInVuZGVmaW5lZCIsImFkZFBsYXllciIsInB1c2giLCJuZXdTaXplIiwic29ja2V0IiwicmVhZHlTdGF0ZSIsIldlYlNvY2tldCIsIk9QRU4iLCJzZW5kIiwic3RyaW5naWZ5IiwidHlwZSIsImNvbnNvbGUiLCJlcnJvciIsInJvb21Db2RlIiwic2VuZEtleUV2ZW50VG9TZXJ2ZXIiLCJrZXkiLCJwcmVzc2VkIiwibG9jYXRpb24iLCJob3N0bmFtZSIsIm9ub3BlbiIsImxvZyIsIm9ubWVzc2FnZSIsImV2ZW50IiwiYWxlcnQiLCJtZXNzYWdlIiwib25jbG9zZSIsIm9uZXJyb3IiLCJfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJleHBvcnRzIiwibW9kdWxlIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsImQiLCJkZWZpbml0aW9uIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsIm9iaiIsInByb3AiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciXSwic291cmNlUm9vdCI6IiJ9