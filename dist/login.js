/*! For license information please see login.js.LICENSE.txt */
(()=>{"use strict";var e={"./src/MenuManager/login.ts":(e,t,o)=>{o.r(t),o.d(t,{handleReadyState:()=>O,handleRoomAction:()=>h,showErrorAnimation:()=>E,showRoomView:()=>v,updateButton:()=>b,updateColorPicker:()=>w,updatePlayerColor:()=>M,updateRoomList:()=>R});var n=o("./src/ViewModels/Player.ts"),r=o("./src/ViewModels/Room.ts"),s=o("./src/WebSocketClient/websocket.ts"),a=null,i=null,c=document.getElementById("roomCodeInput"),l=document.getElementById("usernameInput"),d=document.getElementById("joinButton"),u=document.getElementById("readyButton"),y=document.getElementById("login-div"),m=document.getElementById("room-div"),p=document.getElementById("color-picker"),g=document.getElementById("room-users-list"),f=document.getElementById("room-code"),S=document.getElementById("player-count");function b(){""==l.value.trim()?d.disabled=!0:d.disabled=!1,5==c.value.trim().length?d.textContent="JOIN ROOM":d.textContent="CREATE ROOM"}function h(){var e=l.value;e&&(i=new n.Player(e),"CREATE ROOM"===d.innerText?(0,s.createRoom)(l.value):(0,s.joinRoom)(c.value.toUpperCase(),l.value))}function O(){i.isReady=!i.isReady,(0,s.setPlayerData)(i,a.getCode()),i.isReady?(u.classList.remove("red-button"),u.classList.add("green-button")):(u.classList.add("red-button"),u.classList.remove("green-button"))}function v(e){var t=JSON.parse(e.toString());a=new r.Room(t.room.code,t.room.host,t.room.players,t.room.maxSize),y.classList.add("display-none"),m.classList.add("display-flex"),c.value=a.getCode(),f.innerHTML=a.getCode(),R(e)}function R(e){var t=JSON.parse(e.toString());a.setPlayers(t.room.players),a.setHost(t.room.host),a.setMaxSize(t.room.maxSize),S.innerHTML="".concat(a.getPlayers().length,"/").concat(a.getMaxSize()),g.innerHTML="",a.getPlayers().forEach((function(e){var t=document.createElement("li");t.textContent=e.username+"",e.username==a.getHost().username&&t.insertAdjacentHTML("afterbegin",'<i class="fa-solid fa-crown" style="color: #eed700;"></i>'),e.isReady?t.insertAdjacentHTML("beforeend",' <i class="fa-solid fa-circle" style="color: #37cb48;"></i>'):t.insertAdjacentHTML("beforeend",' <i class="fa-solid fa-circle" style="color: #cb3737;"></i>'),g.appendChild(t)}))}function E(){d.classList.add("red-button"),d.classList.add("wiggle"),setTimeout((function(){d.classList.remove("red-button"),d.classList.remove("wiggle")}),600)}function w(){document.getElementById("color-picker-container").style.backgroundColor=p.value}function M(){var e,t,o;i.color=p.value,document.getElementById("color-label").style.color=("#FFFFFF","#000000",t="#"===(e=p.value).charAt(0)?e.substring(1,7):e,.2126*(o=[parseInt(t.substring(0,2),16)/255,parseInt(t.substring(2,4),16)/255,parseInt(t.substring(4,6),16)/255].map((function(e){return e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)})))[0]+.7152*o[1]+.0722*o[2]>.4?"#000000":"#FFFFFF"),(0,s.setPlayerData)(i,a.getCode())}window.onload=function(){b()},window.updateButton=b,window.handleRoomAction=h,window.handleReadyState=O,window.updateColorPicker=w,window.updatePlayerColor=M},"./src/ViewModels/Player.ts":(e,t,o)=>{o.r(t),o.d(t,{Player:()=>n});var n=function(){function e(e,t){void 0===t&&(t=!1),this.username=e,this.isReady=t,this.color="#000000".replace(/0/g,(function(){return(~~(16*Math.random())).toString(16)}))}return e.prototype.toJSON=function(){return{username:this.username,isReady:this.isReady,color:this.color}},e}()},"./src/ViewModels/Room.ts":(e,t,o)=>{o.r(t),o.d(t,{Room:()=>n});var n=function(){function e(e,t,o,n){void 0===n&&(n=5),this.players=[],this.code=e,this.host=t,this.maxSize=n,null!=o?this.players=o:this.addPlayer(t)}return e.prototype.addPlayer=function(e){return!(this.players.length>=this.maxSize||(this.players.push(e),0))},e.prototype.getCode=function(){return this.code},e.prototype.getPlayers=function(){return this.players},e.prototype.getHost=function(){return this.host},e.prototype.setHost=function(e){this.host=e},e.prototype.setPlayers=function(e){this.players=e},e.prototype.setMaxSize=function(e){this.maxSize=e},e.prototype.getMaxSize=function(){return this.maxSize},e}()},"./src/WebSocketClient/websocket.ts":(e,t,o)=>{o.r(t),o.d(t,{createRoom:()=>s,joinRoom:()=>a,sendKeyEventToServer:()=>c,setPlayerData:()=>i});var n,r=o("./src/MenuManager/login.ts");function s(e){n&&n.readyState===WebSocket.OPEN?n.send(JSON.stringify({type:"CREATE_ROOM",username:e})):console.error("WebSocket connection is not open")}function a(e,t){n&&n.readyState===WebSocket.OPEN?n.send(JSON.stringify({type:"JOIN_ROOM",roomCode:e,username:t})):console.error("WebSocket connection is not open")}function i(e,t){n&&n.readyState===WebSocket.OPEN?n.send(JSON.stringify({type:"PLAYER_DATA",player:e,roomCode:t})):console.error("WebSocket connection is not open")}function c(e,t){n&&n.readyState===WebSocket.OPEN?n.send(JSON.stringify({type:"KEY_EVENT",key:e,pressed:t})):console.error("WebSocket connection is not open")}(n=new WebSocket("ws://".concat(window.location.hostname,":8080"))).onopen=function(){console.log("WebSocket connection established")},n.onmessage=function(e){var t=JSON.parse(e.data);switch(console.log("Message from server:",t),t.type){case"JOINED_ROOM":(0,r.showRoomView)(e.data);break;case"ROOM_DOES_NOT_EXIST":(0,r.showErrorAnimation)();break;case"ROOM_DATA":(0,r.updateRoomList)(e.data);break;case"GAMEPLAY":break;case"ERROR":alert("Error: ".concat(t.message))}},n.onclose=function(){console.log("WebSocket connection closed")},n.onerror=function(e){console.error("WebSocket error:",e)}}},t={};function o(n){var r=t[n];if(void 0!==r)return r.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,o),s.exports}o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o("./src/MenuManager/login.ts")})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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R0FBWSxDQUdqREUsUUFBUyxDQUFDLEdBT1gsT0FIQUUsRUFBb0JKLEdBQVVHLEVBQVFBLEVBQU9ELFFBQVNILEdBRy9DSSxFQUFPRCxPQUNmLENDckJBSCxFQUFvQk0sRUFBSSxDQUFDSCxFQUFTSSxLQUNqQyxJQUFJLElBQUlwQixLQUFPb0IsRUFDWFAsRUFBb0JRLEVBQUVELEVBQVlwQixLQUFTYSxFQUFvQlEsRUFBRUwsRUFBU2hCLElBQzVFc0IsT0FBT0MsZUFBZVAsRUFBU2hCLEVBQUssQ0FBRXdCLFlBQVksRUFBTUMsSUFBS0wsRUFBV3BCLElBRTFFLEVDTkRhLEVBQW9CUSxFQUFJLENBQUNLLEVBQUtDLElBQVVMLE9BQU9NLFVBQVVDLGVBQWVDLEtBQUtKLEVBQUtDLEdDQ2xGZCxFQUFvQmtCLEVBQUtmLElBQ0gsb0JBQVhnQixRQUEwQkEsT0FBT0MsYUFDMUNYLE9BQU9DLGVBQWVQLEVBQVNnQixPQUFPQyxZQUFhLENBQUVsSCxNQUFPLFdBRTdEdUcsT0FBT0MsZUFBZVAsRUFBUyxhQUFjLENBQUVqRyxPQUFPLEdBQU8sRUNGcEM4RixFQUFvQiIsInNvdXJjZXMiOlsid2VicGFjazovL3NuYWtlX2dhbWUvLi9zcmMvTWVudU1hbmFnZXIvbG9naW4udHMiLCJ3ZWJwYWNrOi8vc25ha2VfZ2FtZS8uL3NyYy9WaWV3TW9kZWxzL1BsYXllci50cyIsIndlYnBhY2s6Ly9zbmFrZV9nYW1lLy4vc3JjL1ZpZXdNb2RlbHMvUm9vbS50cyIsIndlYnBhY2s6Ly9zbmFrZV9nYW1lLy4vc3JjL1dlYlNvY2tldENsaWVudC93ZWJzb2NrZXQudHMiLCJ3ZWJwYWNrOi8vc25ha2VfZ2FtZS93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9zbmFrZV9nYW1lL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly9zbmFrZV9nYW1lL3dlYnBhY2svcnVudGltZS9oYXNPd25Qcm9wZXJ0eSBzaG9ydGhhbmQiLCJ3ZWJwYWNrOi8vc25ha2VfZ2FtZS93ZWJwYWNrL3J1bnRpbWUvbWFrZSBuYW1lc3BhY2Ugb2JqZWN0Iiwid2VicGFjazovL3NuYWtlX2dhbWUvd2VicGFjay9zdGFydHVwIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBsYXllciB9IGZyb20gXCIuLi9WaWV3TW9kZWxzL1BsYXllclwiO1xyXG5pbXBvcnQgeyBSb29tIH0gZnJvbSBcIi4uL1ZpZXdNb2RlbHMvUm9vbVwiO1xyXG5pbXBvcnQgeyBjcmVhdGVSb29tLCBqb2luUm9vbSwgc2V0UGxheWVyRGF0YSB9IGZyb20gXCIuLi9XZWJTb2NrZXRDbGllbnQvd2Vic29ja2V0XCI7XHJcblxyXG5cclxubGV0IGN1cnJlbnRSb29tOiBSb29tIHwgbnVsbCA9IG51bGw7XHJcbmxldCBjdXJyZW50UGxheWVyOiBQbGF5ZXIgfCBudWxsID0gbnVsbDtcclxuXHJcbmNvbnN0IHJvb21Db2RlSW5wdXQgPSAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jvb21Db2RlSW5wdXQnKSBhcyBIVE1MSW5wdXRFbGVtZW50KTtcclxuY29uc3QgdXNlcm5hbWVJbnB1dCA9IChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXNlcm5hbWVJbnB1dCcpIGFzIEhUTUxJbnB1dEVsZW1lbnQpO1xyXG5jb25zdCByb29tQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2pvaW5CdXR0b24nKSBhcyBIVE1MQnV0dG9uRWxlbWVudDtcclxuY29uc3QgcmVhZHlCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVhZHlCdXR0b24nKSBhcyBIVE1MQnV0dG9uRWxlbWVudDtcclxuY29uc3QgbG9naW5EaXY9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dpbi1kaXYnKSBhcyBIVE1MQnV0dG9uRWxlbWVudDtcclxuY29uc3Qgcm9vbURpdj0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jvb20tZGl2JykgYXMgSFRNTEJ1dHRvbkVsZW1lbnQ7XHJcbmNvbnN0IGNvbG9yUGlja2VyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbG9yLXBpY2tlcicpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XHJcbmNvbnN0IHJvb21Vc2Vyc0xpc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncm9vbS11c2Vycy1saXN0JykgYXMgSFRNTFVMaXN0RWxlbWVudDtcclxuY29uc3Qgcm9vbUNvZGVTcGFuPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncm9vbS1jb2RlJykgYXMgSFRNTFBhcmFncmFwaEVsZW1lbnQ7XHJcbmNvbnN0IHBsYXllckNvdW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BsYXllci1jb3VudCcpIGFzIEhUTUxQYXJhZ3JhcGhFbGVtZW50O1xyXG5cclxuLy8gc3JjL2xvZ2luLnRzXHJcbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVCdXR0b24oKSB7XHJcbiAgICBcclxuXHJcbiAgICBpZiAodXNlcm5hbWVJbnB1dC52YWx1ZS50cmltKCkgPT0gJycpIHtcclxuICAgICAgICByb29tQnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcm9vbUJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChyb29tQ29kZUlucHV0LnZhbHVlLnRyaW0oKS5sZW5ndGggPT0gNSkge1xyXG4gICAgICAgIHJvb21CdXR0b24udGV4dENvbnRlbnQgPSAnSk9JTiBST09NJztcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcm9vbUJ1dHRvbi50ZXh0Q29udGVudCA9ICdDUkVBVEUgUk9PTSc7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBoYW5kbGVSb29tQWN0aW9uKCkge1xyXG4gICAgY29uc3QgdXNlcm5hbWUgPSB1c2VybmFtZUlucHV0LnZhbHVlO1xyXG4gICAgaWYgKCF1c2VybmFtZSkgcmV0dXJuO1xyXG4gICAgXHJcbiAgICBjdXJyZW50UGxheWVyID0gbmV3IFBsYXllcih1c2VybmFtZSk7XHJcblxyXG4gICAgaWYgKHJvb21CdXR0b24uaW5uZXJUZXh0ID09PSAnQ1JFQVRFIFJPT00nKSB7XHJcbiAgICAgICAgY3JlYXRlUm9vbSh1c2VybmFtZUlucHV0LnZhbHVlKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgXHJcbiAgICAgICAgam9pblJvb20ocm9vbUNvZGVJbnB1dC52YWx1ZS50b1VwcGVyQ2FzZSgpLCB1c2VybmFtZUlucHV0LnZhbHVlKTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGhhbmRsZVJlYWR5U3RhdGUoKSB7XHJcbiAgICBcclxuICAgIGN1cnJlbnRQbGF5ZXIuaXNSZWFkeSA9ICFjdXJyZW50UGxheWVyLmlzUmVhZHk7XHJcbiAgICBzZXRQbGF5ZXJEYXRhKGN1cnJlbnRQbGF5ZXIsIGN1cnJlbnRSb29tLmdldENvZGUoKSk7XHJcbiAgICB1cGRhdGVSZWFkeUJ1dHRvbihjdXJyZW50UGxheWVyLmlzUmVhZHkpO1xyXG4gICAgXHJcbn1cclxuXHJcbmZ1bmN0aW9uIHVwZGF0ZVJlYWR5QnV0dG9uKGlzUmVhZHk6IGJvb2xlYW4pIHtcclxuICAgIGlmKGlzUmVhZHkpe1xyXG4gICAgICAgIHJlYWR5QnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoJ3JlZC1idXR0b24nKTtcclxuICAgICAgICByZWFkeUJ1dHRvbi5jbGFzc0xpc3QuYWRkKCdncmVlbi1idXR0b24nKTtcclxuICAgIH1cclxuICAgIGVsc2V7XHJcbiAgICAgICAgcmVhZHlCdXR0b24uY2xhc3NMaXN0LmFkZCgncmVkLWJ1dHRvbicpO1xyXG4gICAgICAgIHJlYWR5QnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoJ2dyZWVuLWJ1dHRvbicpO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc2hvd1Jvb21WaWV3KGRhdGE6IEpTT04pe1xyXG4gICAgXHJcbiAgICBsZXQgcm9vbUluZm8gPSBKU09OLnBhcnNlKGRhdGEudG9TdHJpbmcoKSk7XHJcbiAgICBjdXJyZW50Um9vbSA9IG5ldyBSb29tIChyb29tSW5mb1sncm9vbSddWydjb2RlJ10sIHJvb21JbmZvWydyb29tJ11bJ2hvc3QnXSwgcm9vbUluZm9bJ3Jvb20nXVsncGxheWVycyddLCByb29tSW5mb1sncm9vbSddWydtYXhTaXplJ10pXHJcblxyXG4gICAgbG9naW5EaXYuY2xhc3NMaXN0LmFkZCgnZGlzcGxheS1ub25lJyk7XHJcbiAgICByb29tRGl2LmNsYXNzTGlzdC5hZGQoJ2Rpc3BsYXktZmxleCcpO1xyXG4gICAgcm9vbUNvZGVJbnB1dC52YWx1ZSA9IGN1cnJlbnRSb29tLmdldENvZGUoKTtcclxuICAgIHJvb21Db2RlU3Bhbi5pbm5lckhUTUwgID0gY3VycmVudFJvb20uZ2V0Q29kZSgpO1xyXG4gICAgdXBkYXRlUm9vbUxpc3QoZGF0YSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVSb29tTGlzdChkYXRhOiBKU09OKXtcclxuICAgIGxldCByb29tSW5mbyA9IEpTT04ucGFyc2UoZGF0YS50b1N0cmluZygpKTtcclxuXHJcbiAgICAvLyB1cGRhdGluZyB0aGUgY3VycmVudCByb29tIHBsYXllcnMgYW5kIGhvc3RcclxuICAgIGN1cnJlbnRSb29tLnNldFBsYXllcnMocm9vbUluZm9bJ3Jvb20nXVsncGxheWVycyddKTtcclxuICAgIGN1cnJlbnRSb29tLnNldEhvc3Qocm9vbUluZm9bJ3Jvb20nXVsnaG9zdCddKTtcclxuICAgIGN1cnJlbnRSb29tLnNldE1heFNpemUocm9vbUluZm9bJ3Jvb20nXVsnbWF4U2l6ZSddKVxyXG5cclxuXHJcbiAgICBwbGF5ZXJDb3VudC5pbm5lckhUTUwgPSBgJHtjdXJyZW50Um9vbS5nZXRQbGF5ZXJzKCkubGVuZ3RofS8ke2N1cnJlbnRSb29tLmdldE1heFNpemUoKX1gO1xyXG4gICAgcm9vbVVzZXJzTGlzdC5pbm5lckhUTUwgPSAnJztcclxuXHJcbiAgICBjdXJyZW50Um9vbS5nZXRQbGF5ZXJzKCkuZm9yRWFjaCgocGxheWVyOiB7IHVzZXJuYW1lOiBzdHJpbmcgfCBudW1iZXI7IGlzUmVhZHk6IGJvb2xlYW47IH0pID0+IHtcclxuICAgICAgICBjb25zdCBwbGF5ZXJJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcclxuXHJcbiAgICAgICAgcGxheWVySXRlbS50ZXh0Q29udGVudCA9IHBsYXllci51c2VybmFtZSArICcnO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmKHBsYXllci51c2VybmFtZSA9PSBjdXJyZW50Um9vbS5nZXRIb3N0KCkudXNlcm5hbWUpIHtcclxuICAgICAgICAgICAgcGxheWVySXRlbS5pbnNlcnRBZGphY2VudEhUTUwoJ2FmdGVyYmVnaW4nLCAnPGkgY2xhc3M9XCJmYS1zb2xpZCBmYS1jcm93blwiIHN0eWxlPVwiY29sb3I6ICNlZWQ3MDA7XCI+PC9pPicpXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHBsYXllci5pc1JlYWR5KSB7XHJcbiAgICAgICAgICAgIHBsYXllckl0ZW0uaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVlbmQnLCAnIDxpIGNsYXNzPVwiZmEtc29saWQgZmEtY2lyY2xlXCIgc3R5bGU9XCJjb2xvcjogIzM3Y2I0ODtcIj48L2k+Jyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcGxheWVySXRlbS5pbnNlcnRBZGphY2VudEhUTUwoJ2JlZm9yZWVuZCcsICcgPGkgY2xhc3M9XCJmYS1zb2xpZCBmYS1jaXJjbGVcIiBzdHlsZT1cImNvbG9yOiAjY2IzNzM3O1wiPjwvaT4nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJvb21Vc2Vyc0xpc3QuYXBwZW5kQ2hpbGQocGxheWVySXRlbSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBzaG93RXJyb3JBbmltYXRpb24oKSB7XHJcbiAgICByb29tQnV0dG9uLmNsYXNzTGlzdC5hZGQoJ3JlZC1idXR0b24nKTtcclxuICAgIHJvb21CdXR0b24uY2xhc3NMaXN0LmFkZCgnd2lnZ2xlJyk7XHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgIHJvb21CdXR0b24uY2xhc3NMaXN0LnJlbW92ZSgncmVkLWJ1dHRvbicpO1xyXG4gICAgcm9vbUJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCd3aWdnbGUnKTtcclxuICAgIH0sIDYwMClcclxufVxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVDb2xvclBpY2tlcigpIHtcclxuICAgIGxldCBjb2xvclBpY2tlckRpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb2xvci1waWNrZXItY29udGFpbmVyJyk7XHJcbiAgICBjb2xvclBpY2tlckRpdi5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBjb2xvclBpY2tlci52YWx1ZTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZVBsYXllckNvbG9yKCkge1xyXG4gICAgY3VycmVudFBsYXllci5jb2xvciA9IGNvbG9yUGlja2VyLnZhbHVlO1xyXG4gICAgbGV0IGNvbG9yUGlja2VyTGFiZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29sb3ItbGFiZWwnKTtcclxuICAgIGNvbG9yUGlja2VyTGFiZWwuc3R5bGUuY29sb3IgPSBwaWNrVGV4dENvbG9yQmFzZWRPbkJnQ29sb3JBZHZhbmNlZChjb2xvclBpY2tlci52YWx1ZSwgJyNGRkZGRkYnLCAnIzAwMDAwMCcpO1xyXG4gICAgc2V0UGxheWVyRGF0YShjdXJyZW50UGxheWVyLCBjdXJyZW50Um9vbS5nZXRDb2RlKCkpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBwaWNrVGV4dENvbG9yQmFzZWRPbkJnQ29sb3JBZHZhbmNlZChiZ0NvbG9yOnN0cmluZywgbGlnaHRDb2xvcjogc3RyaW5nLCBkYXJrQ29sb3I6IHN0cmluZykge1xyXG4gICAgdmFyIGNvbG9yID0gKGJnQ29sb3IuY2hhckF0KDApID09PSAnIycpID8gYmdDb2xvci5zdWJzdHJpbmcoMSwgNykgOiBiZ0NvbG9yO1xyXG4gICAgdmFyIHIgPSBwYXJzZUludChjb2xvci5zdWJzdHJpbmcoMCwgMiksIDE2KTsgLy8gaGV4VG9SXHJcbiAgICB2YXIgZyA9IHBhcnNlSW50KGNvbG9yLnN1YnN0cmluZygyLCA0KSwgMTYpOyAvLyBoZXhUb0dcclxuICAgIHZhciBiID0gcGFyc2VJbnQoY29sb3Iuc3Vic3RyaW5nKDQsIDYpLCAxNik7IC8vIGhleFRvQlxyXG4gICAgdmFyIHVpY29sb3JzID0gW3IgLyAyNTUsIGcgLyAyNTUsIGIgLyAyNTVdO1xyXG4gICAgdmFyIGMgPSB1aWNvbG9ycy5tYXAoKGNvbCkgPT4ge1xyXG4gICAgICBpZiAoY29sIDw9IDAuMDM5MjgpIHtcclxuICAgICAgICByZXR1cm4gY29sIC8gMTIuOTI7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIE1hdGgucG93KChjb2wgKyAwLjA1NSkgLyAxLjA1NSwgMi40KTtcclxuICAgIH0pO1xyXG4gICAgdmFyIEwgPSAoMC4yMTI2ICogY1swXSkgKyAoMC43MTUyICogY1sxXSkgKyAoMC4wNzIyICogY1syXSk7XHJcbiAgICByZXR1cm4gKEwgPiAwLjQpID8gZGFya0NvbG9yIDogbGlnaHRDb2xvcjtcclxuICB9XHJcblxyXG53aW5kb3cub25sb2FkID0gKCkgPT4ge1xyXG4gICAgdXBkYXRlQnV0dG9uKCk7XHJcbn07XHJcblxyXG4od2luZG93IGFzIGFueSkudXBkYXRlQnV0dG9uID0gdXBkYXRlQnV0dG9uO1xyXG4od2luZG93IGFzIGFueSkuaGFuZGxlUm9vbUFjdGlvbiA9IGhhbmRsZVJvb21BY3Rpb247XHJcbih3aW5kb3cgYXMgYW55KS5oYW5kbGVSZWFkeVN0YXRlID0gaGFuZGxlUmVhZHlTdGF0ZTtcclxuKHdpbmRvdyBhcyBhbnkpLnVwZGF0ZUNvbG9yUGlja2VyID0gdXBkYXRlQ29sb3JQaWNrZXI7XHJcbih3aW5kb3cgYXMgYW55KS51cGRhdGVQbGF5ZXJDb2xvciA9IHVwZGF0ZVBsYXllckNvbG9yOyIsImV4cG9ydCBjbGFzcyBQbGF5ZXIge1xyXG4gICAgcHVibGljIHVzZXJuYW1lOiBzdHJpbmc7XHJcbiAgICBwdWJsaWMgaXNSZWFkeTogYm9vbGVhbjtcclxuICAgIHB1YmxpYyBjb2xvcjogc3RyaW5nO1xyXG4gICAgXHJcbiAgICBjb25zdHJ1Y3Rvcih1c2VybmFtZTogc3RyaW5nLCBpc1JlYWR5OiBib29sZWFuID0gZmFsc2UpIHtcclxuICAgICAgICB0aGlzLnVzZXJuYW1lID0gdXNlcm5hbWU7XHJcbiAgICAgICAgdGhpcy5pc1JlYWR5ID0gaXNSZWFkeTtcclxuICAgICAgICB0aGlzLmNvbG9yID0gXCIjMDAwMDAwXCIucmVwbGFjZSgvMC9nLGZ1bmN0aW9uKCl7cmV0dXJuICh+fihNYXRoLnJhbmRvbSgpKjE2KSkudG9TdHJpbmcoMTYpO30pO1xyXG4gICAgfVxyXG5cclxuICAgIHRvSlNPTigpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgdXNlcm5hbWU6IHRoaXMudXNlcm5hbWUsXHJcbiAgICAgICAgICBpc1JlYWR5OiB0aGlzLmlzUmVhZHksXHJcbiAgICAgICAgICBjb2xvcjogdGhpcy5jb2xvclxyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuXHJcbn0iLCJpbXBvcnQgeyBQbGF5ZXIgfSBmcm9tIFwiLi9QbGF5ZXJcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBSb29tIHtcclxuICAgIHByaXZhdGUgcGxheWVyczogUGxheWVyW10gPSBbXTtcclxuICAgIHByaXZhdGUgbWF4U2l6ZTogbnVtYmVyO1xyXG4gICAgcHJpdmF0ZSBob3N0OiBQbGF5ZXI7XHJcbiAgICBwcml2YXRlIGNvZGU6IHN0cmluZztcclxuXHJcblxyXG4gICAgY29uc3RydWN0b3IoY29kZTogc3RyaW5nLCBob3N0OiBQbGF5ZXIsIHBsYXllcnM/OiBQbGF5ZXJbXSwgbWF4U2l6ZTogbnVtYmVyID0gNSkge1xyXG4gICAgICAgIHRoaXMuY29kZSA9IGNvZGU7XHJcbiAgICAgICAgdGhpcy5ob3N0ID0gaG9zdDtcclxuICAgICAgICB0aGlzLm1heFNpemUgPSBtYXhTaXplO1xyXG5cclxuICAgICAgICBpZiAocGxheWVycyAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5wbGF5ZXJzID0gcGxheWVycztcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgdGhpcy5hZGRQbGF5ZXIoaG9zdCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgYWRkUGxheWVyKHBsYXllcjogUGxheWVyKTogYm9vbGVhbiB7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLnBsYXllcnMubGVuZ3RoID49IHRoaXMubWF4U2l6ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnBsYXllcnMucHVzaChwbGF5ZXIpXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldENvZGUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY29kZTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0UGxheWVycygpOiBQbGF5ZXJbXSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucGxheWVycztcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0SG9zdCgpOiBQbGF5ZXIge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmhvc3Q7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldEhvc3QocGxheWVyOiBQbGF5ZXIpIHtcclxuICAgICAgICB0aGlzLmhvc3QgPSBwbGF5ZXI7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldFBsYXllcnMocGxheWVyczogUGxheWVyW10pe1xyXG4gICAgICAgIHRoaXMucGxheWVycyA9IHBsYXllcnM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldE1heFNpemUobmV3U2l6ZTogbnVtYmVyKXtcclxuICAgICAgICB0aGlzLm1heFNpemUgPSBuZXdTaXplO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRNYXhTaXplKCl7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubWF4U2l6ZTtcclxuICAgIH1cclxufSIsImltcG9ydCB7IHNob3dFcnJvckFuaW1hdGlvbiwgc2hvd1Jvb21WaWV3LCB1cGRhdGVSb29tTGlzdCB9IGZyb20gXCIuLi9NZW51TWFuYWdlci9sb2dpblwiO1xyXG5pbXBvcnQgeyBQbGF5ZXIgfSBmcm9tIFwiLi4vVmlld01vZGVscy9QbGF5ZXJcIjtcclxuXHJcbmxldCBzb2NrZXQ6IFdlYlNvY2tldDtcclxuXHJcbmZ1bmN0aW9uIGluaXRXZWJTb2NrZXQoKSB7XHJcbiAgICBzb2NrZXQgPSBuZXcgV2ViU29ja2V0KGB3czovLyR7d2luZG93LmxvY2F0aW9uLmhvc3RuYW1lfTo4MDgwYCk7XHJcbiAgICBcclxuICAgIHNvY2tldC5vbm9wZW4gPSAoKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1dlYlNvY2tldCBjb25uZWN0aW9uIGVzdGFibGlzaGVkJyk7XHJcbiAgICB9O1xyXG5cclxuICAgIHNvY2tldC5vbm1lc3NhZ2UgPSAoZXZlbnQpID0+IHtcclxuICAgICAgICBjb25zdCBkYXRhID0gSlNPTi5wYXJzZShldmVudC5kYXRhKTtcclxuICAgICAgICBjb25zb2xlLmxvZygnTWVzc2FnZSBmcm9tIHNlcnZlcjonLCBkYXRhKTtcclxuICAgICAgICBcclxuICAgICAgICBzd2l0Y2ggKGRhdGEudHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlICdKT0lORURfUk9PTSc6XHJcbiAgICAgICAgICAgICAgICBzaG93Um9vbVZpZXcoZXZlbnQuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnUk9PTV9ET0VTX05PVF9FWElTVCc6XHJcbiAgICAgICAgICAgICAgICBzaG93RXJyb3JBbmltYXRpb24oKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdST09NX0RBVEEnOlxyXG4gICAgICAgICAgICAgICAgdXBkYXRlUm9vbUxpc3QoZXZlbnQuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnR0FNRVBMQVknOlxyXG4gICAgICAgICAgICAgICAgLy8gdXBkYXRlR2FtZUNhbnZhcygpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ0VSUk9SJzpcclxuICAgICAgICAgICAgICAgIGFsZXJ0KGBFcnJvcjogJHtkYXRhLm1lc3NhZ2V9YCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBzb2NrZXQub25jbG9zZSA9ICgpID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZygnV2ViU29ja2V0IGNvbm5lY3Rpb24gY2xvc2VkJyk7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBzb2NrZXQub25lcnJvciA9IChlcnJvcikgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1dlYlNvY2tldCBlcnJvcjonLCBlcnJvcik7XHJcbiAgICB9O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlUm9vbSh1c2VybmFtZTogc3RyaW5nKSB7XHJcbiAgICBpZiAoc29ja2V0ICYmIHNvY2tldC5yZWFkeVN0YXRlID09PSBXZWJTb2NrZXQuT1BFTikge1xyXG4gICAgICAgIHNvY2tldC5zZW5kKEpTT04uc3RyaW5naWZ5KHsgdHlwZTogJ0NSRUFURV9ST09NJywgdXNlcm5hbWU6IHVzZXJuYW1lIH0pKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignV2ViU29ja2V0IGNvbm5lY3Rpb24gaXMgbm90IG9wZW4nKTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGpvaW5Sb29tKHJvb21Db2RlOiBzdHJpbmcsIHVzZXJuYW1lOiBzdHJpbmcpIHtcclxuICAgIGlmIChzb2NrZXQgJiYgc29ja2V0LnJlYWR5U3RhdGUgPT09IFdlYlNvY2tldC5PUEVOKSB7XHJcbiAgICAgICAgc29ja2V0LnNlbmQoSlNPTi5zdHJpbmdpZnkoeyB0eXBlOiAnSk9JTl9ST09NJywgcm9vbUNvZGU6IHJvb21Db2RlLCB1c2VybmFtZTogdXNlcm5hbWUgfSkpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdXZWJTb2NrZXQgY29ubmVjdGlvbiBpcyBub3Qgb3BlbicpO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc2V0UGxheWVyRGF0YShwbGF5ZXI6IFBsYXllciwgcm9vbUNvZGU6IHN0cmluZykge1xyXG4gICAgaWYgKHNvY2tldCAmJiBzb2NrZXQucmVhZHlTdGF0ZSA9PT0gV2ViU29ja2V0Lk9QRU4pIHtcclxuICAgICAgICBzb2NrZXQuc2VuZChKU09OLnN0cmluZ2lmeSh7IHR5cGU6ICdQTEFZRVJfREFUQScsIHBsYXllcjogcGxheWVyLCByb29tQ29kZTogcm9vbUNvZGV9KSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1dlYlNvY2tldCBjb25uZWN0aW9uIGlzIG5vdCBvcGVuJyk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBzZW5kS2V5RXZlbnRUb1NlcnZlcihrZXk6IHN0cmluZywgcHJlc3NlZDogYm9vbGVhbil7XHJcbiAgICBpZiAoc29ja2V0ICYmIHNvY2tldC5yZWFkeVN0YXRlID09PSBXZWJTb2NrZXQuT1BFTikge1xyXG4gICAgICAgIHNvY2tldC5zZW5kKEpTT04uc3RyaW5naWZ5KHsgdHlwZTogJ0tFWV9FVkVOVCcsIGtleToga2V5LCBwcmVzc2VkOiBwcmVzc2VkIH0pKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignV2ViU29ja2V0IGNvbm5lY3Rpb24gaXMgbm90IG9wZW4nKTtcclxuICAgIH1cclxufVxyXG5cclxuXHJcbmluaXRXZWJTb2NrZXQoKTtcclxuIiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0dmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07XG5cdGlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdHJldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXShtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbiIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCIvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSAoZXhwb3J0cykgPT4ge1xuXHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcblx0fVxuXHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xufTsiLCIvLyBzdGFydHVwXG4vLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbi8vIFRoaXMgZW50cnkgbW9kdWxlIGlzIHJlZmVyZW5jZWQgYnkgb3RoZXIgbW9kdWxlcyBzbyBpdCBjYW4ndCBiZSBpbmxpbmVkXG52YXIgX193ZWJwYWNrX2V4cG9ydHNfXyA9IF9fd2VicGFja19yZXF1aXJlX18oXCIuL3NyYy9NZW51TWFuYWdlci9sb2dpbi50c1wiKTtcbiJdLCJuYW1lcyI6WyJjdXJyZW50Um9vbSIsImN1cnJlbnRQbGF5ZXIiLCJyb29tQ29kZUlucHV0IiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInVzZXJuYW1lSW5wdXQiLCJyb29tQnV0dG9uIiwicmVhZHlCdXR0b24iLCJsb2dpbkRpdiIsInJvb21EaXYiLCJjb2xvclBpY2tlciIsInJvb21Vc2Vyc0xpc3QiLCJyb29tQ29kZVNwYW4iLCJwbGF5ZXJDb3VudCIsInVwZGF0ZUJ1dHRvbiIsInZhbHVlIiwidHJpbSIsImRpc2FibGVkIiwibGVuZ3RoIiwidGV4dENvbnRlbnQiLCJoYW5kbGVSb29tQWN0aW9uIiwidXNlcm5hbWUiLCJQbGF5ZXIiLCJpbm5lclRleHQiLCJjcmVhdGVSb29tIiwiam9pblJvb20iLCJ0b1VwcGVyQ2FzZSIsImhhbmRsZVJlYWR5U3RhdGUiLCJpc1JlYWR5Iiwic2V0UGxheWVyRGF0YSIsImdldENvZGUiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJhZGQiLCJzaG93Um9vbVZpZXciLCJkYXRhIiwicm9vbUluZm8iLCJKU09OIiwicGFyc2UiLCJ0b1N0cmluZyIsIlJvb20iLCJpbm5lckhUTUwiLCJ1cGRhdGVSb29tTGlzdCIsInNldFBsYXllcnMiLCJzZXRIb3N0Iiwic2V0TWF4U2l6ZSIsImdldFBsYXllcnMiLCJnZXRNYXhTaXplIiwiZm9yRWFjaCIsInBsYXllciIsInBsYXllckl0ZW0iLCJjcmVhdGVFbGVtZW50IiwiZ2V0SG9zdCIsImluc2VydEFkamFjZW50SFRNTCIsImFwcGVuZENoaWxkIiwic2hvd0Vycm9yQW5pbWF0aW9uIiwic2V0VGltZW91dCIsInVwZGF0ZUNvbG9yUGlja2VyIiwic3R5bGUiLCJiYWNrZ3JvdW5kQ29sb3IiLCJ1cGRhdGVQbGF5ZXJDb2xvciIsImJnQ29sb3IiLCJjb2xvciIsImMiLCJjaGFyQXQiLCJzdWJzdHJpbmciLCJwYXJzZUludCIsIm1hcCIsImNvbCIsIk1hdGgiLCJwb3ciLCJ3aW5kb3ciLCJvbmxvYWQiLCJ0aGlzIiwicmVwbGFjZSIsInJhbmRvbSIsInRvSlNPTiIsImNvZGUiLCJob3N0IiwicGxheWVycyIsIm1heFNpemUiLCJ1bmRlZmluZWQiLCJhZGRQbGF5ZXIiLCJwdXNoIiwibmV3U2l6ZSIsInNvY2tldCIsInJlYWR5U3RhdGUiLCJXZWJTb2NrZXQiLCJPUEVOIiwic2VuZCIsInN0cmluZ2lmeSIsInR5cGUiLCJjb25zb2xlIiwiZXJyb3IiLCJyb29tQ29kZSIsInNlbmRLZXlFdmVudFRvU2VydmVyIiwia2V5IiwicHJlc3NlZCIsImxvY2F0aW9uIiwiaG9zdG5hbWUiLCJvbm9wZW4iLCJsb2ciLCJvbm1lc3NhZ2UiLCJldmVudCIsImFsZXJ0IiwibWVzc2FnZSIsIm9uY2xvc2UiLCJvbmVycm9yIiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiY2FjaGVkTW9kdWxlIiwiZXhwb3J0cyIsIm1vZHVsZSIsIl9fd2VicGFja19tb2R1bGVzX18iLCJkIiwiZGVmaW5pdGlvbiIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJvYmoiLCJwcm9wIiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIl0sInNvdXJjZVJvb3QiOiIifQ==