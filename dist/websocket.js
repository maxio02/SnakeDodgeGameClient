/*! For license information please see websocket.js.LICENSE.txt */
(()=>{"use strict";var e={"./src/MenuManager/login.ts":(e,t,o)=>{o.r(t),o.d(t,{handleReadyState:()=>O,handleRoomAction:()=>h,showErrorAnimation:()=>w,showRoomView:()=>v,updateButton:()=>S,updateColorPicker:()=>E,updatePlayerColor:()=>M,updateRoomList:()=>R});var n=o("./src/ViewModels/Player.ts"),r=o("./src/ViewModels/Room.ts"),s=o("./src/WebSocketClient/websocket.ts"),a=null,i=null,c=document.getElementById("roomCodeInput"),l=document.getElementById("usernameInput"),d=document.getElementById("joinButton"),u=document.getElementById("readyButton"),y=document.getElementById("login-div"),m=document.getElementById("room-div"),p=document.getElementById("color-picker"),g=document.getElementById("room-users-list"),f=document.getElementById("room-code"),b=document.getElementById("player-count");function S(){""==l.value.trim()?d.disabled=!0:d.disabled=!1,5==c.value.trim().length?d.textContent="JOIN ROOM":d.textContent="CREATE ROOM"}function h(){var e=l.value;e&&(i=new n.Player(e),"CREATE ROOM"===d.innerText?(0,s.createRoom)(l.value):(0,s.joinRoom)(c.value.toUpperCase(),l.value))}function O(){i.isReady=!i.isReady,(0,s.setPlayerData)(i,a.getCode()),i.isReady?(u.classList.remove("red-button"),u.classList.add("green-button")):(u.classList.add("red-button"),u.classList.remove("green-button"))}function v(e){var t=JSON.parse(e.toString());a=new r.Room(t.room.code,t.room.host,t.room.players,t.room.maxSize),y.classList.add("display-none"),m.classList.add("display-flex"),c.value=a.getCode(),f.innerHTML=a.getCode(),R(e)}function R(e){var t=JSON.parse(e.toString());a.setPlayers(t.room.players),a.setHost(t.room.host),a.setMaxSize(t.room.maxSize),b.innerHTML="".concat(a.getPlayers().length,"/").concat(a.getMaxSize()),g.innerHTML="",a.getPlayers().forEach((function(e){var t=document.createElement("li");t.textContent=e.username+"",e.username==a.getHost().username&&t.insertAdjacentHTML("afterbegin",'<i class="fa-solid fa-crown" style="color: #eed700;"></i>'),e.isReady?t.insertAdjacentHTML("beforeend",' <i class="fa-solid fa-circle" style="color: #37cb48;"></i>'):t.insertAdjacentHTML("beforeend",' <i class="fa-solid fa-circle" style="color: #cb3737;"></i>'),g.appendChild(t)}))}function w(){d.classList.add("red-button"),d.classList.add("wiggle"),setTimeout((function(){d.classList.remove("red-button"),d.classList.remove("wiggle")}),600)}function E(){document.getElementById("color-picker-container").style.backgroundColor=p.value}function M(){var e,t,o;i.color=p.value,document.getElementById("color-label").style.color=("#FFFFFF","#000000",t="#"===(e=p.value).charAt(0)?e.substring(1,7):e,.2126*(o=[parseInt(t.substring(0,2),16)/255,parseInt(t.substring(2,4),16)/255,parseInt(t.substring(4,6),16)/255].map((function(e){return e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)})))[0]+.7152*o[1]+.0722*o[2]>.4?"#000000":"#FFFFFF"),(0,s.setPlayerData)(i,a.getCode())}window.onload=function(){S()},window.updateButton=S,window.handleRoomAction=h,window.handleReadyState=O,window.updateColorPicker=E,window.updatePlayerColor=M},"./src/ViewModels/Player.ts":(e,t,o)=>{o.r(t),o.d(t,{Player:()=>n});var n=function(){function e(e,t){void 0===t&&(t=!1),this.username=e,this.isReady=t,this.color="#000000".replace(/0/g,(function(){return(~~(16*Math.random())).toString(16)}))}return e.prototype.toJSON=function(){return{username:this.username,isReady:this.isReady,color:this.color}},e}()},"./src/ViewModels/Room.ts":(e,t,o)=>{o.r(t),o.d(t,{Room:()=>n});var n=function(){function e(e,t,o,n){void 0===n&&(n=5),this.players=[],this.code=e,this.host=t,this.maxSize=n,null!=o?this.players=o:this.addPlayer(t)}return e.prototype.addPlayer=function(e){return!(this.players.length>=this.maxSize||(this.players.push(e),0))},e.prototype.getCode=function(){return this.code},e.prototype.getPlayers=function(){return this.players},e.prototype.getHost=function(){return this.host},e.prototype.setHost=function(e){this.host=e},e.prototype.setPlayers=function(e){this.players=e},e.prototype.setMaxSize=function(e){this.maxSize=e},e.prototype.getMaxSize=function(){return this.maxSize},e}()},"./src/WebSocketClient/websocket.ts":(e,t,o)=>{o.r(t),o.d(t,{createRoom:()=>s,joinRoom:()=>a,sendKeyEventToServer:()=>c,setPlayerData:()=>i});var n,r=o("./src/MenuManager/login.ts");function s(e){n&&n.readyState===WebSocket.OPEN?n.send(JSON.stringify({type:"CREATE_ROOM",username:e})):console.error("WebSocket connection is not open")}function a(e,t){n&&n.readyState===WebSocket.OPEN?n.send(JSON.stringify({type:"JOIN_ROOM",roomCode:e,username:t})):console.error("WebSocket connection is not open")}function i(e,t){n&&n.readyState===WebSocket.OPEN?n.send(JSON.stringify({type:"PLAYER_DATA",player:e,roomCode:t})):console.error("WebSocket connection is not open")}function c(e,t){n&&n.readyState===WebSocket.OPEN?n.send(JSON.stringify({type:"KEY_EVENT",key:e,pressed:t})):console.error("WebSocket connection is not open")}(n=new WebSocket("ws://".concat(window.location.hostname,":8080"))).onopen=function(){console.log("WebSocket connection established")},n.onmessage=function(e){var t=JSON.parse(e.data);switch(console.log("Message from server:",t),t.type){case"JOINED_ROOM":(0,r.showRoomView)(e.data);break;case"ROOM_DOES_NOT_EXIST":(0,r.showErrorAnimation)();break;case"ROOM_DATA":(0,r.updateRoomList)(e.data);break;case"GAMEPLAY":break;case"ERROR":alert("Error: ".concat(t.message))}},n.onclose=function(){console.log("WebSocket connection closed")},n.onerror=function(e){console.error("WebSocket error:",e)}}},t={};function o(n){var r=t[n];if(void 0!==r)return r.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,o),s.exports}o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o("./src/WebSocketClient/websocket.ts")})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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eUJFLEdBQVksQ0FHakRFLFFBQVMsQ0FBQyxHQU9YLE9BSEFFLEVBQW9CSixHQUFVRyxFQUFRQSxFQUFPRCxRQUFTSCxHQUcvQ0ksRUFBT0QsT0FDZixDQ3JCQUgsRUFBb0JNLEVBQUksQ0FBQ0gsRUFBU0ksS0FDakMsSUFBSSxJQUFJcEIsS0FBT29CLEVBQ1hQLEVBQW9CUSxFQUFFRCxFQUFZcEIsS0FBU2EsRUFBb0JRLEVBQUVMLEVBQVNoQixJQUM1RXNCLE9BQU9DLGVBQWVQLEVBQVNoQixFQUFLLENBQUV3QixZQUFZLEVBQU1DLElBQUtMLEVBQVdwQixJQUUxRSxFQ05EYSxFQUFvQlEsRUFBSSxDQUFDSyxFQUFLQyxJQUFVTCxPQUFPTSxVQUFVQyxlQUFlQyxLQUFLSixFQUFLQyxHQ0NsRmQsRUFBb0JrQixFQUFLZixJQUNILG9CQUFYZ0IsUUFBMEJBLE9BQU9DLGFBQzFDWCxPQUFPQyxlQUFlUCxFQUFTZ0IsT0FBT0MsWUFBYSxDQUFFbEgsTUFBTyxXQUU3RHVHLE9BQU9DLGVBQWVQLEVBQVMsYUFBYyxDQUFFakcsT0FBTyxHQUFPLEVDRnBDOEYsRUFBb0IiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zbmFrZV9nYW1lLy4vc3JjL01lbnVNYW5hZ2VyL2xvZ2luLnRzIiwid2VicGFjazovL3NuYWtlX2dhbWUvLi9zcmMvVmlld01vZGVscy9QbGF5ZXIudHMiLCJ3ZWJwYWNrOi8vc25ha2VfZ2FtZS8uL3NyYy9WaWV3TW9kZWxzL1Jvb20udHMiLCJ3ZWJwYWNrOi8vc25ha2VfZ2FtZS8uL3NyYy9XZWJTb2NrZXRDbGllbnQvd2Vic29ja2V0LnRzIiwid2VicGFjazovL3NuYWtlX2dhbWUvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vc25ha2VfZ2FtZS93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vc25ha2VfZ2FtZS93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL3NuYWtlX2dhbWUvd2VicGFjay9ydW50aW1lL21ha2UgbmFtZXNwYWNlIG9iamVjdCIsIndlYnBhY2s6Ly9zbmFrZV9nYW1lL3dlYnBhY2svc3RhcnR1cCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQbGF5ZXIgfSBmcm9tIFwiLi4vVmlld01vZGVscy9QbGF5ZXJcIjtcclxuaW1wb3J0IHsgUm9vbSB9IGZyb20gXCIuLi9WaWV3TW9kZWxzL1Jvb21cIjtcclxuaW1wb3J0IHsgY3JlYXRlUm9vbSwgam9pblJvb20sIHNldFBsYXllckRhdGEgfSBmcm9tIFwiLi4vV2ViU29ja2V0Q2xpZW50L3dlYnNvY2tldFwiO1xyXG5cclxuXHJcbmxldCBjdXJyZW50Um9vbTogUm9vbSB8IG51bGwgPSBudWxsO1xyXG5sZXQgY3VycmVudFBsYXllcjogUGxheWVyIHwgbnVsbCA9IG51bGw7XHJcblxyXG5jb25zdCByb29tQ29kZUlucHV0ID0gKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyb29tQ29kZUlucHV0JykgYXMgSFRNTElucHV0RWxlbWVudCk7XHJcbmNvbnN0IHVzZXJuYW1lSW5wdXQgPSAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VzZXJuYW1lSW5wdXQnKSBhcyBIVE1MSW5wdXRFbGVtZW50KTtcclxuY29uc3Qgcm9vbUJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdqb2luQnV0dG9uJykgYXMgSFRNTEJ1dHRvbkVsZW1lbnQ7XHJcbmNvbnN0IHJlYWR5QnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlYWR5QnV0dG9uJykgYXMgSFRNTEJ1dHRvbkVsZW1lbnQ7XHJcbmNvbnN0IGxvZ2luRGl2PSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9naW4tZGl2JykgYXMgSFRNTEJ1dHRvbkVsZW1lbnQ7XHJcbmNvbnN0IHJvb21EaXY9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyb29tLWRpdicpIGFzIEhUTUxCdXR0b25FbGVtZW50O1xyXG5jb25zdCBjb2xvclBpY2tlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb2xvci1waWNrZXInKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xyXG5jb25zdCByb29tVXNlcnNMaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jvb20tdXNlcnMtbGlzdCcpIGFzIEhUTUxVTGlzdEVsZW1lbnQ7XHJcbmNvbnN0IHJvb21Db2RlU3Bhbj0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jvb20tY29kZScpIGFzIEhUTUxQYXJhZ3JhcGhFbGVtZW50O1xyXG5jb25zdCBwbGF5ZXJDb3VudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwbGF5ZXItY291bnQnKSBhcyBIVE1MUGFyYWdyYXBoRWxlbWVudDtcclxuXHJcbi8vIHNyYy9sb2dpbi50c1xyXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlQnV0dG9uKCkge1xyXG4gICAgXHJcblxyXG4gICAgaWYgKHVzZXJuYW1lSW5wdXQudmFsdWUudHJpbSgpID09ICcnKSB7XHJcbiAgICAgICAgcm9vbUJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJvb21CdXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAocm9vbUNvZGVJbnB1dC52YWx1ZS50cmltKCkubGVuZ3RoID09IDUpIHtcclxuICAgICAgICByb29tQnV0dG9uLnRleHRDb250ZW50ID0gJ0pPSU4gUk9PTSc7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJvb21CdXR0b24udGV4dENvbnRlbnQgPSAnQ1JFQVRFIFJPT00nO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaGFuZGxlUm9vbUFjdGlvbigpIHtcclxuICAgIGNvbnN0IHVzZXJuYW1lID0gdXNlcm5hbWVJbnB1dC52YWx1ZTtcclxuICAgIGlmICghdXNlcm5hbWUpIHJldHVybjtcclxuICAgIFxyXG4gICAgY3VycmVudFBsYXllciA9IG5ldyBQbGF5ZXIodXNlcm5hbWUpO1xyXG5cclxuICAgIGlmIChyb29tQnV0dG9uLmlubmVyVGV4dCA9PT0gJ0NSRUFURSBST09NJykge1xyXG4gICAgICAgIGNyZWF0ZVJvb20odXNlcm5hbWVJbnB1dC52YWx1ZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIFxyXG4gICAgICAgIGpvaW5Sb29tKHJvb21Db2RlSW5wdXQudmFsdWUudG9VcHBlckNhc2UoKSwgdXNlcm5hbWVJbnB1dC52YWx1ZSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBoYW5kbGVSZWFkeVN0YXRlKCkge1xyXG4gICAgXHJcbiAgICBjdXJyZW50UGxheWVyLmlzUmVhZHkgPSAhY3VycmVudFBsYXllci5pc1JlYWR5O1xyXG4gICAgc2V0UGxheWVyRGF0YShjdXJyZW50UGxheWVyLCBjdXJyZW50Um9vbS5nZXRDb2RlKCkpO1xyXG4gICAgdXBkYXRlUmVhZHlCdXR0b24oY3VycmVudFBsYXllci5pc1JlYWR5KTtcclxuICAgIFxyXG59XHJcblxyXG5mdW5jdGlvbiB1cGRhdGVSZWFkeUJ1dHRvbihpc1JlYWR5OiBib29sZWFuKSB7XHJcbiAgICBpZihpc1JlYWR5KXtcclxuICAgICAgICByZWFkeUJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCdyZWQtYnV0dG9uJyk7XHJcbiAgICAgICAgcmVhZHlCdXR0b24uY2xhc3NMaXN0LmFkZCgnZ3JlZW4tYnV0dG9uJyk7XHJcbiAgICB9XHJcbiAgICBlbHNle1xyXG4gICAgICAgIHJlYWR5QnV0dG9uLmNsYXNzTGlzdC5hZGQoJ3JlZC1idXR0b24nKTtcclxuICAgICAgICByZWFkeUJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCdncmVlbi1idXR0b24nKTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNob3dSb29tVmlldyhkYXRhOiBKU09OKXtcclxuICAgIFxyXG4gICAgbGV0IHJvb21JbmZvID0gSlNPTi5wYXJzZShkYXRhLnRvU3RyaW5nKCkpO1xyXG4gICAgY3VycmVudFJvb20gPSBuZXcgUm9vbSAocm9vbUluZm9bJ3Jvb20nXVsnY29kZSddLCByb29tSW5mb1sncm9vbSddWydob3N0J10sIHJvb21JbmZvWydyb29tJ11bJ3BsYXllcnMnXSwgcm9vbUluZm9bJ3Jvb20nXVsnbWF4U2l6ZSddKVxyXG5cclxuICAgIGxvZ2luRGl2LmNsYXNzTGlzdC5hZGQoJ2Rpc3BsYXktbm9uZScpO1xyXG4gICAgcm9vbURpdi5jbGFzc0xpc3QuYWRkKCdkaXNwbGF5LWZsZXgnKTtcclxuICAgIHJvb21Db2RlSW5wdXQudmFsdWUgPSBjdXJyZW50Um9vbS5nZXRDb2RlKCk7XHJcbiAgICByb29tQ29kZVNwYW4uaW5uZXJIVE1MICA9IGN1cnJlbnRSb29tLmdldENvZGUoKTtcclxuICAgIHVwZGF0ZVJvb21MaXN0KGRhdGEpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlUm9vbUxpc3QoZGF0YTogSlNPTil7XHJcbiAgICBsZXQgcm9vbUluZm8gPSBKU09OLnBhcnNlKGRhdGEudG9TdHJpbmcoKSk7XHJcblxyXG4gICAgLy8gdXBkYXRpbmcgdGhlIGN1cnJlbnQgcm9vbSBwbGF5ZXJzIGFuZCBob3N0XHJcbiAgICBjdXJyZW50Um9vbS5zZXRQbGF5ZXJzKHJvb21JbmZvWydyb29tJ11bJ3BsYXllcnMnXSk7XHJcbiAgICBjdXJyZW50Um9vbS5zZXRIb3N0KHJvb21JbmZvWydyb29tJ11bJ2hvc3QnXSk7XHJcbiAgICBjdXJyZW50Um9vbS5zZXRNYXhTaXplKHJvb21JbmZvWydyb29tJ11bJ21heFNpemUnXSlcclxuXHJcblxyXG4gICAgcGxheWVyQ291bnQuaW5uZXJIVE1MID0gYCR7Y3VycmVudFJvb20uZ2V0UGxheWVycygpLmxlbmd0aH0vJHtjdXJyZW50Um9vbS5nZXRNYXhTaXplKCl9YDtcclxuICAgIHJvb21Vc2Vyc0xpc3QuaW5uZXJIVE1MID0gJyc7XHJcblxyXG4gICAgY3VycmVudFJvb20uZ2V0UGxheWVycygpLmZvckVhY2goKHBsYXllcjogeyB1c2VybmFtZTogc3RyaW5nIHwgbnVtYmVyOyBpc1JlYWR5OiBib29sZWFuOyB9KSA9PiB7XHJcbiAgICAgICAgY29uc3QgcGxheWVySXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XHJcblxyXG4gICAgICAgIHBsYXllckl0ZW0udGV4dENvbnRlbnQgPSBwbGF5ZXIudXNlcm5hbWUgKyAnJztcclxuICAgICAgICBcclxuICAgICAgICBpZihwbGF5ZXIudXNlcm5hbWUgPT0gY3VycmVudFJvb20uZ2V0SG9zdCgpLnVzZXJuYW1lKSB7XHJcbiAgICAgICAgICAgIHBsYXllckl0ZW0uaW5zZXJ0QWRqYWNlbnRIVE1MKCdhZnRlcmJlZ2luJywgJzxpIGNsYXNzPVwiZmEtc29saWQgZmEtY3Jvd25cIiBzdHlsZT1cImNvbG9yOiAjZWVkNzAwO1wiPjwvaT4nKVxyXG4gICAgICAgICAgICBcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChwbGF5ZXIuaXNSZWFkeSkge1xyXG4gICAgICAgICAgICBwbGF5ZXJJdGVtLmluc2VydEFkamFjZW50SFRNTCgnYmVmb3JlZW5kJywgJyA8aSBjbGFzcz1cImZhLXNvbGlkIGZhLWNpcmNsZVwiIHN0eWxlPVwiY29sb3I6ICMzN2NiNDg7XCI+PC9pPicpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHBsYXllckl0ZW0uaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVlbmQnLCAnIDxpIGNsYXNzPVwiZmEtc29saWQgZmEtY2lyY2xlXCIgc3R5bGU9XCJjb2xvcjogI2NiMzczNztcIj48L2k+Jyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByb29tVXNlcnNMaXN0LmFwcGVuZENoaWxkKHBsYXllckl0ZW0pO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc2hvd0Vycm9yQW5pbWF0aW9uKCkge1xyXG4gICAgcm9vbUJ1dHRvbi5jbGFzc0xpc3QuYWRkKCdyZWQtYnV0dG9uJyk7XHJcbiAgICByb29tQnV0dG9uLmNsYXNzTGlzdC5hZGQoJ3dpZ2dsZScpO1xyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICByb29tQnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoJ3JlZC1idXR0b24nKTtcclxuICAgIHJvb21CdXR0b24uY2xhc3NMaXN0LnJlbW92ZSgnd2lnZ2xlJyk7XHJcbiAgICB9LCA2MDApXHJcbn1cclxuXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlQ29sb3JQaWNrZXIoKSB7XHJcbiAgICBsZXQgY29sb3JQaWNrZXJEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29sb3ItcGlja2VyLWNvbnRhaW5lcicpO1xyXG4gICAgY29sb3JQaWNrZXJEaXYuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gY29sb3JQaWNrZXIudmFsdWU7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVQbGF5ZXJDb2xvcigpIHtcclxuICAgIGN1cnJlbnRQbGF5ZXIuY29sb3IgPSBjb2xvclBpY2tlci52YWx1ZTtcclxuICAgIGxldCBjb2xvclBpY2tlckxhYmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbG9yLWxhYmVsJyk7XHJcbiAgICBjb2xvclBpY2tlckxhYmVsLnN0eWxlLmNvbG9yID0gcGlja1RleHRDb2xvckJhc2VkT25CZ0NvbG9yQWR2YW5jZWQoY29sb3JQaWNrZXIudmFsdWUsICcjRkZGRkZGJywgJyMwMDAwMDAnKTtcclxuICAgIHNldFBsYXllckRhdGEoY3VycmVudFBsYXllciwgY3VycmVudFJvb20uZ2V0Q29kZSgpKTtcclxufVxyXG5cclxuZnVuY3Rpb24gcGlja1RleHRDb2xvckJhc2VkT25CZ0NvbG9yQWR2YW5jZWQoYmdDb2xvcjpzdHJpbmcsIGxpZ2h0Q29sb3I6IHN0cmluZywgZGFya0NvbG9yOiBzdHJpbmcpIHtcclxuICAgIHZhciBjb2xvciA9IChiZ0NvbG9yLmNoYXJBdCgwKSA9PT0gJyMnKSA/IGJnQ29sb3Iuc3Vic3RyaW5nKDEsIDcpIDogYmdDb2xvcjtcclxuICAgIHZhciByID0gcGFyc2VJbnQoY29sb3Iuc3Vic3RyaW5nKDAsIDIpLCAxNik7IC8vIGhleFRvUlxyXG4gICAgdmFyIGcgPSBwYXJzZUludChjb2xvci5zdWJzdHJpbmcoMiwgNCksIDE2KTsgLy8gaGV4VG9HXHJcbiAgICB2YXIgYiA9IHBhcnNlSW50KGNvbG9yLnN1YnN0cmluZyg0LCA2KSwgMTYpOyAvLyBoZXhUb0JcclxuICAgIHZhciB1aWNvbG9ycyA9IFtyIC8gMjU1LCBnIC8gMjU1LCBiIC8gMjU1XTtcclxuICAgIHZhciBjID0gdWljb2xvcnMubWFwKChjb2wpID0+IHtcclxuICAgICAgaWYgKGNvbCA8PSAwLjAzOTI4KSB7XHJcbiAgICAgICAgcmV0dXJuIGNvbCAvIDEyLjkyO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBNYXRoLnBvdygoY29sICsgMC4wNTUpIC8gMS4wNTUsIDIuNCk7XHJcbiAgICB9KTtcclxuICAgIHZhciBMID0gKDAuMjEyNiAqIGNbMF0pICsgKDAuNzE1MiAqIGNbMV0pICsgKDAuMDcyMiAqIGNbMl0pO1xyXG4gICAgcmV0dXJuIChMID4gMC40KSA/IGRhcmtDb2xvciA6IGxpZ2h0Q29sb3I7XHJcbiAgfVxyXG5cclxud2luZG93Lm9ubG9hZCA9ICgpID0+IHtcclxuICAgIHVwZGF0ZUJ1dHRvbigpO1xyXG59O1xyXG5cclxuKHdpbmRvdyBhcyBhbnkpLnVwZGF0ZUJ1dHRvbiA9IHVwZGF0ZUJ1dHRvbjtcclxuKHdpbmRvdyBhcyBhbnkpLmhhbmRsZVJvb21BY3Rpb24gPSBoYW5kbGVSb29tQWN0aW9uO1xyXG4od2luZG93IGFzIGFueSkuaGFuZGxlUmVhZHlTdGF0ZSA9IGhhbmRsZVJlYWR5U3RhdGU7XHJcbih3aW5kb3cgYXMgYW55KS51cGRhdGVDb2xvclBpY2tlciA9IHVwZGF0ZUNvbG9yUGlja2VyO1xyXG4od2luZG93IGFzIGFueSkudXBkYXRlUGxheWVyQ29sb3IgPSB1cGRhdGVQbGF5ZXJDb2xvcjsiLCJleHBvcnQgY2xhc3MgUGxheWVyIHtcclxuICAgIHB1YmxpYyB1c2VybmFtZTogc3RyaW5nO1xyXG4gICAgcHVibGljIGlzUmVhZHk6IGJvb2xlYW47XHJcbiAgICBwdWJsaWMgY29sb3I6IHN0cmluZztcclxuICAgIFxyXG4gICAgY29uc3RydWN0b3IodXNlcm5hbWU6IHN0cmluZywgaXNSZWFkeTogYm9vbGVhbiA9IGZhbHNlKSB7XHJcbiAgICAgICAgdGhpcy51c2VybmFtZSA9IHVzZXJuYW1lO1xyXG4gICAgICAgIHRoaXMuaXNSZWFkeSA9IGlzUmVhZHk7XHJcbiAgICAgICAgdGhpcy5jb2xvciA9IFwiIzAwMDAwMFwiLnJlcGxhY2UoLzAvZyxmdW5jdGlvbigpe3JldHVybiAofn4oTWF0aC5yYW5kb20oKSoxNikpLnRvU3RyaW5nKDE2KTt9KTtcclxuICAgIH1cclxuXHJcbiAgICB0b0pTT04oKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIHVzZXJuYW1lOiB0aGlzLnVzZXJuYW1lLFxyXG4gICAgICAgICAgaXNSZWFkeTogdGhpcy5pc1JlYWR5LFxyXG4gICAgICAgICAgY29sb3I6IHRoaXMuY29sb3JcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcblxyXG59IiwiaW1wb3J0IHsgUGxheWVyIH0gZnJvbSBcIi4vUGxheWVyXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgUm9vbSB7XHJcbiAgICBwcml2YXRlIHBsYXllcnM6IFBsYXllcltdID0gW107XHJcbiAgICBwcml2YXRlIG1heFNpemU6IG51bWJlcjtcclxuICAgIHByaXZhdGUgaG9zdDogUGxheWVyO1xyXG4gICAgcHJpdmF0ZSBjb2RlOiBzdHJpbmc7XHJcblxyXG5cclxuICAgIGNvbnN0cnVjdG9yKGNvZGU6IHN0cmluZywgaG9zdDogUGxheWVyLCBwbGF5ZXJzPzogUGxheWVyW10sIG1heFNpemU6IG51bWJlciA9IDUpIHtcclxuICAgICAgICB0aGlzLmNvZGUgPSBjb2RlO1xyXG4gICAgICAgIHRoaXMuaG9zdCA9IGhvc3Q7XHJcbiAgICAgICAgdGhpcy5tYXhTaXplID0gbWF4U2l6ZTtcclxuXHJcbiAgICAgICAgaWYgKHBsYXllcnMgIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMucGxheWVycyA9IHBsYXllcnM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2V7XHJcbiAgICAgICAgICAgIHRoaXMuYWRkUGxheWVyKGhvc3QpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGFkZFBsYXllcihwbGF5ZXI6IFBsYXllcik6IGJvb2xlYW4ge1xyXG5cclxuICAgICAgICBpZiAodGhpcy5wbGF5ZXJzLmxlbmd0aCA+PSB0aGlzLm1heFNpemUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5wbGF5ZXJzLnB1c2gocGxheWVyKVxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRDb2RlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNvZGU7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldFBsYXllcnMoKTogUGxheWVyW10ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnBsYXllcnM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldEhvc3QoKTogUGxheWVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5ob3N0O1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXRIb3N0KHBsYXllcjogUGxheWVyKSB7XHJcbiAgICAgICAgdGhpcy5ob3N0ID0gcGxheWVyO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXRQbGF5ZXJzKHBsYXllcnM6IFBsYXllcltdKXtcclxuICAgICAgICB0aGlzLnBsYXllcnMgPSBwbGF5ZXJzO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXRNYXhTaXplKG5ld1NpemU6IG51bWJlcil7XHJcbiAgICAgICAgdGhpcy5tYXhTaXplID0gbmV3U2l6ZTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0TWF4U2l6ZSgpe1xyXG4gICAgICAgIHJldHVybiB0aGlzLm1heFNpemU7XHJcbiAgICB9XHJcbn0iLCJpbXBvcnQgeyBzaG93RXJyb3JBbmltYXRpb24sIHNob3dSb29tVmlldywgdXBkYXRlUm9vbUxpc3QgfSBmcm9tIFwiLi4vTWVudU1hbmFnZXIvbG9naW5cIjtcclxuaW1wb3J0IHsgUGxheWVyIH0gZnJvbSBcIi4uL1ZpZXdNb2RlbHMvUGxheWVyXCI7XHJcblxyXG5sZXQgc29ja2V0OiBXZWJTb2NrZXQ7XHJcblxyXG5mdW5jdGlvbiBpbml0V2ViU29ja2V0KCkge1xyXG4gICAgc29ja2V0ID0gbmV3IFdlYlNvY2tldChgd3M6Ly8ke3dpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZX06ODA4MGApO1xyXG4gICAgXHJcbiAgICBzb2NrZXQub25vcGVuID0gKCkgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdXZWJTb2NrZXQgY29ubmVjdGlvbiBlc3RhYmxpc2hlZCcpO1xyXG4gICAgfTtcclxuXHJcbiAgICBzb2NrZXQub25tZXNzYWdlID0gKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgY29uc3QgZGF0YSA9IEpTT04ucGFyc2UoZXZlbnQuZGF0YSk7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ01lc3NhZ2UgZnJvbSBzZXJ2ZXI6JywgZGF0YSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgc3dpdGNoIChkYXRhLnR5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSAnSk9JTkVEX1JPT00nOlxyXG4gICAgICAgICAgICAgICAgc2hvd1Jvb21WaWV3KGV2ZW50LmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ1JPT01fRE9FU19OT1RfRVhJU1QnOlxyXG4gICAgICAgICAgICAgICAgc2hvd0Vycm9yQW5pbWF0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnUk9PTV9EQVRBJzpcclxuICAgICAgICAgICAgICAgIHVwZGF0ZVJvb21MaXN0KGV2ZW50LmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ0dBTUVQTEFZJzpcclxuICAgICAgICAgICAgICAgIC8vIHVwZGF0ZUdhbWVDYW52YXMoKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdFUlJPUic6XHJcbiAgICAgICAgICAgICAgICBhbGVydChgRXJyb3I6ICR7ZGF0YS5tZXNzYWdlfWApO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFxyXG4gICAgc29ja2V0Lm9uY2xvc2UgPSAoKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1dlYlNvY2tldCBjb25uZWN0aW9uIGNsb3NlZCcpO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgc29ja2V0Lm9uZXJyb3IgPSAoZXJyb3IpID0+IHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdXZWJTb2NrZXQgZXJyb3I6JywgZXJyb3IpO1xyXG4gICAgfTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVJvb20odXNlcm5hbWU6IHN0cmluZykge1xyXG4gICAgaWYgKHNvY2tldCAmJiBzb2NrZXQucmVhZHlTdGF0ZSA9PT0gV2ViU29ja2V0Lk9QRU4pIHtcclxuICAgICAgICBzb2NrZXQuc2VuZChKU09OLnN0cmluZ2lmeSh7IHR5cGU6ICdDUkVBVEVfUk9PTScsIHVzZXJuYW1lOiB1c2VybmFtZSB9KSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1dlYlNvY2tldCBjb25uZWN0aW9uIGlzIG5vdCBvcGVuJyk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBqb2luUm9vbShyb29tQ29kZTogc3RyaW5nLCB1c2VybmFtZTogc3RyaW5nKSB7XHJcbiAgICBpZiAoc29ja2V0ICYmIHNvY2tldC5yZWFkeVN0YXRlID09PSBXZWJTb2NrZXQuT1BFTikge1xyXG4gICAgICAgIHNvY2tldC5zZW5kKEpTT04uc3RyaW5naWZ5KHsgdHlwZTogJ0pPSU5fUk9PTScsIHJvb21Db2RlOiByb29tQ29kZSwgdXNlcm5hbWU6IHVzZXJuYW1lIH0pKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignV2ViU29ja2V0IGNvbm5lY3Rpb24gaXMgbm90IG9wZW4nKTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNldFBsYXllckRhdGEocGxheWVyOiBQbGF5ZXIsIHJvb21Db2RlOiBzdHJpbmcpIHtcclxuICAgIGlmIChzb2NrZXQgJiYgc29ja2V0LnJlYWR5U3RhdGUgPT09IFdlYlNvY2tldC5PUEVOKSB7XHJcbiAgICAgICAgc29ja2V0LnNlbmQoSlNPTi5zdHJpbmdpZnkoeyB0eXBlOiAnUExBWUVSX0RBVEEnLCBwbGF5ZXI6IHBsYXllciwgcm9vbUNvZGU6IHJvb21Db2RlfSkpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdXZWJTb2NrZXQgY29ubmVjdGlvbiBpcyBub3Qgb3BlbicpO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc2VuZEtleUV2ZW50VG9TZXJ2ZXIoa2V5OiBzdHJpbmcsIHByZXNzZWQ6IGJvb2xlYW4pe1xyXG4gICAgaWYgKHNvY2tldCAmJiBzb2NrZXQucmVhZHlTdGF0ZSA9PT0gV2ViU29ja2V0Lk9QRU4pIHtcclxuICAgICAgICBzb2NrZXQuc2VuZChKU09OLnN0cmluZ2lmeSh7IHR5cGU6ICdLRVlfRVZFTlQnLCBrZXk6IGtleSwgcHJlc3NlZDogcHJlc3NlZCB9KSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1dlYlNvY2tldCBjb25uZWN0aW9uIGlzIG5vdCBvcGVuJyk7XHJcbiAgICB9XHJcbn1cclxuXHJcblxyXG5pbml0V2ViU29ja2V0KCk7XHJcbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0obW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4ge1xuXHRmb3IodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pO1xuXHRcdH1cblx0fVxufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIiwiLy8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5yID0gKGV4cG9ydHMpID0+IHtcblx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG5cdH1cblx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbn07IiwiLy8gc3RhcnR1cFxuLy8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4vLyBUaGlzIGVudHJ5IG1vZHVsZSBpcyByZWZlcmVuY2VkIGJ5IG90aGVyIG1vZHVsZXMgc28gaXQgY2FuJ3QgYmUgaW5saW5lZFxudmFyIF9fd2VicGFja19leHBvcnRzX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKFwiLi9zcmMvV2ViU29ja2V0Q2xpZW50L3dlYnNvY2tldC50c1wiKTtcbiJdLCJuYW1lcyI6WyJjdXJyZW50Um9vbSIsImN1cnJlbnRQbGF5ZXIiLCJyb29tQ29kZUlucHV0IiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInVzZXJuYW1lSW5wdXQiLCJyb29tQnV0dG9uIiwicmVhZHlCdXR0b24iLCJsb2dpbkRpdiIsInJvb21EaXYiLCJjb2xvclBpY2tlciIsInJvb21Vc2Vyc0xpc3QiLCJyb29tQ29kZVNwYW4iLCJwbGF5ZXJDb3VudCIsInVwZGF0ZUJ1dHRvbiIsInZhbHVlIiwidHJpbSIsImRpc2FibGVkIiwibGVuZ3RoIiwidGV4dENvbnRlbnQiLCJoYW5kbGVSb29tQWN0aW9uIiwidXNlcm5hbWUiLCJQbGF5ZXIiLCJpbm5lclRleHQiLCJjcmVhdGVSb29tIiwiam9pblJvb20iLCJ0b1VwcGVyQ2FzZSIsImhhbmRsZVJlYWR5U3RhdGUiLCJpc1JlYWR5Iiwic2V0UGxheWVyRGF0YSIsImdldENvZGUiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJhZGQiLCJzaG93Um9vbVZpZXciLCJkYXRhIiwicm9vbUluZm8iLCJKU09OIiwicGFyc2UiLCJ0b1N0cmluZyIsIlJvb20iLCJpbm5lckhUTUwiLCJ1cGRhdGVSb29tTGlzdCIsInNldFBsYXllcnMiLCJzZXRIb3N0Iiwic2V0TWF4U2l6ZSIsImdldFBsYXllcnMiLCJnZXRNYXhTaXplIiwiZm9yRWFjaCIsInBsYXllciIsInBsYXllckl0ZW0iLCJjcmVhdGVFbGVtZW50IiwiZ2V0SG9zdCIsImluc2VydEFkamFjZW50SFRNTCIsImFwcGVuZENoaWxkIiwic2hvd0Vycm9yQW5pbWF0aW9uIiwic2V0VGltZW91dCIsInVwZGF0ZUNvbG9yUGlja2VyIiwic3R5bGUiLCJiYWNrZ3JvdW5kQ29sb3IiLCJ1cGRhdGVQbGF5ZXJDb2xvciIsImJnQ29sb3IiLCJjb2xvciIsImMiLCJjaGFyQXQiLCJzdWJzdHJpbmciLCJwYXJzZUludCIsIm1hcCIsImNvbCIsIk1hdGgiLCJwb3ciLCJ3aW5kb3ciLCJvbmxvYWQiLCJ0aGlzIiwicmVwbGFjZSIsInJhbmRvbSIsInRvSlNPTiIsImNvZGUiLCJob3N0IiwicGxheWVycyIsIm1heFNpemUiLCJ1bmRlZmluZWQiLCJhZGRQbGF5ZXIiLCJwdXNoIiwibmV3U2l6ZSIsInNvY2tldCIsInJlYWR5U3RhdGUiLCJXZWJTb2NrZXQiLCJPUEVOIiwic2VuZCIsInN0cmluZ2lmeSIsInR5cGUiLCJjb25zb2xlIiwiZXJyb3IiLCJyb29tQ29kZSIsInNlbmRLZXlFdmVudFRvU2VydmVyIiwia2V5IiwicHJlc3NlZCIsImxvY2F0aW9uIiwiaG9zdG5hbWUiLCJvbm9wZW4iLCJsb2ciLCJvbm1lc3NhZ2UiLCJldmVudCIsImFsZXJ0IiwibWVzc2FnZSIsIm9uY2xvc2UiLCJvbmVycm9yIiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiY2FjaGVkTW9kdWxlIiwiZXhwb3J0cyIsIm1vZHVsZSIsIl9fd2VicGFja19tb2R1bGVzX18iLCJkIiwiZGVmaW5pdGlvbiIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJvYmoiLCJwcm9wIiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIl0sInNvdXJjZVJvb3QiOiIifQ==